
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Hexo</title>
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>HEXO</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;HEXO</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div
        id="home-background"
        ref="homeBackground"
        data-images="/images/background.jpg"
    ></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>Hexo</h1>
                <h3></h3>
                <h5></h5>
            </div>
        </span>
    </div>
</div>
<div
    id="home-posts-wrap"
    ref="homePostsWrap"
    true
>
    <div id="home-posts">
        

<div class="post">
    <a href="/2025/06/27/Kotlin%E4%BD%BF%E7%94%A8DSL%E6%9E%84%E5%BB%BA%E4%B8%93%E6%9C%89%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84/">
        <h2 class="post-title">Kotlin使用DSL构建专有语法结构</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Kotlin/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Kotlin
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/27
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="DSL构建专有的语法结构"><a href="#DSL构建专有的语法结构" class="headerlink" title="DSL构建专有的语法结构"></a>DSL构建专有的语法结构</h3><p>DSL 是专为特定领域（如数据库查询、配置文件、UI布局等）设计的编程语言或语言的一个子集。Kotlin 提供了丰富的支持，帮助开发者用 Kotlin 代码构建出自己的 DSL 语言结构，以使得代码更加易读和易写。</p>
<ul>
<li><strong>扩展函数</strong>：你可以通过扩展函数给现有类添加自定义功能，从而实现新的语法结构。</li>
<li><strong>高阶函数</strong>：Kotlin 允许将函数作为参数传递给其他函数，这使得定义和构建 DSL 成为可能。</li>
<li><strong>Lambda 表达式</strong>：你可以通过 lambda 表达式使代码更加简洁，形成类似声明式的语法。</li>
<li><strong>智能类型推断</strong>：这使得你无需显式声明类型，语法更清晰，推导更自然。</li>
</ul>
<h3 id="Lambda-with-Receiver（接收者-lambda）"><a href="#Lambda-with-Receiver（接收者-lambda）" class="headerlink" title="Lambda with Receiver（接收者 lambda）"></a>Lambda with Receiver（接收者 lambda）</h3><p>接收者 lambda 允许在 lambda 中访问外部对象的成员，而不需要显式的引用对象。通过这种方式，你可以通过一个语法块来访问和操作对象，类似于嵌套调用的结构。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DSL</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span> = println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">dslExample</span><span class="params">(<span class="keyword">init</span>: <span class="type">DSL</span>.() -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> dsl = DSL()</span><br><span class="line">    dsl.<span class="keyword">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    dslExample &#123;</span><br><span class="line">        sayHello()  <span class="comment">// 直接调用 DSL 中的方法，类似于在 &quot;this&quot; 上调用方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>init</code> 是一个扩展函数 <code>DSL.() -&gt; Unit</code>，其中 <code>DSL</code> 是接收者类型，而 <code>init</code> 是一个 lambda 表达式，它可以直接访问 <code>DSL</code> 类的成员。</p>
<h3 id="构建层次结构"><a href="#构建层次结构" class="headerlink" title="构建层次结构"></a>构建层次结构</h3><p>你可以使用 lambda 表达式来构建一个嵌套的结构，这在构建树形结构或配置文件时特别有用。例如，构建 UI 或 HTML 模板时，嵌套的 DSL 会让代码看起来更简洁。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Td</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> content=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">html</span><span class="params">()</span></span>=<span class="string">&quot;\n\t\t&lt;td&gt;<span class="variable">$content</span>&lt;/td&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tr</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> children=ArrayList&lt;Td&gt;()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">td</span><span class="params">(block:<span class="type">Td</span>.()-&gt;<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> td=Td()</span><br><span class="line">        td.content=td.block()</span><br><span class="line">        children.add(td)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">html</span><span class="params">()</span></span>:String&#123;</span><br><span class="line">        <span class="keyword">val</span> builder=StringBuilder()</span><br><span class="line">        builder.append(<span class="string">&quot;\n\t&lt;tr&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (childTag <span class="keyword">in</span> children)&#123;</span><br><span class="line">            builder.append(childTag.html())</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(<span class="string">&quot;\n\t&lt;tr&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> builder.toString()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Table</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> children=ArrayList&lt;Tr&gt;()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">tr</span><span class="params">(block: <span class="type">Tr</span>.() -&gt; <span class="type">Unit</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> tr=Tr()</span><br><span class="line">        tr.block()</span><br><span class="line">        children.add(tr)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">html</span><span class="params">()</span></span>:String&#123;</span><br><span class="line">        <span class="keyword">val</span> builder=StringBuilder()</span><br><span class="line">        builder.append(<span class="string">&quot;&lt;table&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (childTag <span class="keyword">in</span> children)&#123;</span><br><span class="line">            builder.append(childTag.html())</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(<span class="string">&quot;\n&lt;/table&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> builder.toString()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">table</span><span class="params">(block:<span class="type">Table</span>.()-&gt;<span class="type">Unit</span>)</span></span>:String&#123;</span><br><span class="line">    <span class="keyword">val</span> table=Table()</span><br><span class="line">    table.block()</span><br><span class="line">    <span class="keyword">return</span> table.html()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">/*val table=Table()</span></span><br><span class="line"><span class="comment">    table.tr &#123;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Apple&quot;&#125;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Grape&quot;&#125;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Orange&quot;&#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    table.tr &#123;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Pear&quot;&#125;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Banana&quot;&#125;</span></span><br><span class="line"><span class="comment">        td&#123;&quot;Watermelon&quot;&#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="keyword">val</span> html= table &#123;</span><br><span class="line">        tr &#123;</span><br><span class="line">            td&#123;<span class="string">&quot;Apple&quot;</span>&#125;</span><br><span class="line">            td&#123;<span class="string">&quot;Grape&quot;</span>&#125;</span><br><span class="line">            td&#123;<span class="string">&quot;Orange&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        tr &#123;</span><br><span class="line">            td&#123;<span class="string">&quot;Pear&quot;</span>&#125;</span><br><span class="line">            td&#123;<span class="string">&quot;Banana&quot;</span>&#125;</span><br><span class="line">            td&#123;<span class="string">&quot;Watermelon&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(html)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，我们创建了一个简单的 HTML 构建器 DSL。你可以在外部 <code>html</code> 块中定义结构，从而形成一个层次化的结构。</p>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/27/Kotlin%E4%BD%BF%E7%94%A8DSL%E6%9E%84%E5%BB%BA%E4%B8%93%E6%9C%89%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/06/25/Jetpack/">
        <h2 class="post-title">Jetpack(Kotlin)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Android-Kotlin%E7%89%88/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Android(Kotlin版)
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="Jetpack"><a href="#Jetpack" class="headerlink" title="Jetpack"></a>Jetpack</h1><h3 id="Jetpack全家福"><a href="#Jetpack全家福" class="headerlink" title="Jetpack全家福"></a>Jetpack全家福</h3><p><img src="/../img/img60.jpg"></p>
<hr>
<h1 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h1><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>帮助Activity分担一部分工作，专门用于存放与界面相关的数据的，他可以保证在手机屏幕发生旋转时不会被重新创建，数据不会丢失</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><img src="/../img/img61.jpg"></p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><ul>
<li><p>添加依赖</p>
</li>
<li><p>创建一个ViewModel类继承自ViewModel()</p>
</li>
<li><p>把界面相关的数据都放入其中</p>
</li>
<li><p>在Activity或fragment中创建其实例</p>
</li>
<li><p>构建相关逻辑</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation (<span class="string">&quot;androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2&quot;</span>) <span class="comment">// Kotlin 版本</span></span><br><span class="line">implementation (<span class="string">&quot;androidx.lifecycle:lifecycle-viewmodel:2.6.2&quot;</span>)     <span class="comment">// Java 版本</span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(countReserved: <span class="built_in">Int</span>) : ViewModel() &#123;</span><br><span class="line">	<span class="keyword">var</span> counter=<span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> viewModel: MainViewModel</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        <span class="comment">//获取实例</span></span><br><span class="line">        viewModel=ViewModelProvider(<span class="keyword">this</span>).<span class="keyword">get</span>(MainViewModel::<span class="keyword">class</span>.java)</span><br><span class="line">        binding.plus.setOnClickListener &#123;</span><br><span class="line">            viewModel.counter++</span><br><span class="line">            refreshCounter()</span><br><span class="line">        &#125;</span><br><span class="line">        refreshCounter()</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">refreshCounter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        binding.infoText.text=viewModel.counter.toString()</span><br><span class="line">    &#125;o</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="像ViewModel传递参数"><a href="#像ViewModel传递参数" class="headerlink" title="像ViewModel传递参数"></a>像ViewModel传递参数</h3><ul>
<li><p>添加参数</p>
</li>
<li><p>新建ViewModelFactory类，实现ViewModelProvider.Factory接口</p>
</li>
<li><p>利用SharedPreferences保存数据</p>
</li>
<li><p>读取数据，将数据传入到ViewModelFactory的构造函数中</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(countReserved: <span class="built_in">Int</span>) : ViewModel() &#123;</span><br><span class="line">   <span class="keyword">var</span> counter=countReserved</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModelFactory</span>(<span class="keyword">private</span> <span class="keyword">val</span> countReserved:<span class="built_in">Int</span>):ViewModelProvider.Factory &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">return</span> MainViewModel(countReserved) <span class="keyword">as</span> T</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> viewModel: MainViewModel</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> sp:SharedPreferences</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        sp=getPreferences(Context.MODE_PRIVATE)</span><br><span class="line">        <span class="keyword">val</span> contReserved=sp.getInt(<span class="string">&quot;count_reserved&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        viewModel=ViewModelProvider(<span class="keyword">this</span>,MainViewModelFactory(contReserved)).<span class="keyword">get</span>(MainViewModel::<span class="keyword">class</span>.java)</span><br><span class="line">        binding.plus.setOnClickListener &#123;</span><br><span class="line">            viewModel.counter++</span><br><span class="line">            refreshCounter()</span><br><span class="line">        &#125;</span><br><span class="line">        binding.clear.setOnClickListener &#123;</span><br><span class="line">            viewModel.counter=<span class="number">0</span></span><br><span class="line">            refreshCounter()</span><br><span class="line">        &#125;</span><br><span class="line">        refreshCounter() </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">refreshCounter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        binding.infoText.text=viewModel.counter.toString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPause</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause()</span><br><span class="line">        sp.edit &#123;</span><br><span class="line">            putInt(<span class="string">&quot;count_reserved&quot;</span>,viewModel.counter.value?:<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="Lifecycles"><a href="#Lifecycles" class="headerlink" title="Lifecycles"></a>Lifecycles</h1><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>他可以让任何一个类轻松地感知到Activity生命周期</p>
<h3 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h3><ul>
<li><p>新建一个类</p>
</li>
<li><p>借助注解能力编写逻辑代码</p>
</li>
<li><p>获取LifecycleOwer实例，Activity或者Fragment本身就是一个LifecycleOwer实例</p>
</li>
<li><p>在活动中进行调用(也可以在任何地方调用lifecycle.currentState来主动获取当前生命周期状态)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyObserver</span>(<span class="keyword">val</span> lifecycle: Lifecycle):LifecycleObserver &#123;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_START)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">activityStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MyObserver&quot;</span>, <span class="string">&quot;activityStart: &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_STOP)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">activityStop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MyObserve&quot;</span>, <span class="string">&quot;activityStop: &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lifecycle.addObserver(MyObserver())</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h1><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><ul>
<li><p><strong>添加依赖</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;androidx.lifecycle:lifecycle-livedata-ktx:2.5.1&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建LiveData</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span> (countReserved:<span class="built_in">Int</span>): ViewModel() &#123;</span><br><span class="line">    <span class="comment">// 创建 LiveData</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _counter = MutableLiveData&lt;<span class="built_in">Int</span>&gt;()</span><br><span class="line">    <span class="keyword">val</span> counter: LiveData&lt;<span class="built_in">Int</span>&gt; <span class="keyword">get</span>() = _counter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        _counter.value = countReserved</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新 LiveData 数据</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">incrementCounter</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _counter.value = (_counter.value ?: <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>MutableLiveData</strong>: 可变的 LiveData 类型，允许数据更新。</li>
<li><strong>LiveData</strong>: 不可变的 LiveData 类型，只能观察数据，不能直接修改数据。</li>
</ul>
</li>
<li><h4 id="在-Activity-或-Fragment-中观察-LiveData"><a href="#在-Activity-或-Fragment-中观察-LiveData" class="headerlink" title="在 Activity 或 Fragment 中观察 LiveData"></a><strong>在 Activity 或 Fragment 中观察 LiveData</strong></h4><p>在 Activity 或 Fragment 中，你可以通过 <code>observe()</code> 方法观察 LiveData。当数据发生变化时，LiveData 才会发送更新。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 ViewModel 实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> myViewModel: MyViewModel <span class="keyword">by</span> viewModels()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 观察 LiveData 数据</span></span><br><span class="line">        myViewModel.counter.observe(<span class="keyword">this</span>)&#123; count -&gt;</span><br><span class="line">            <span class="comment">// 更新 UI</span></span><br><span class="line">            counterText.text = count.toString()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置按钮点击事件</span></span><br><span class="line">        incrementButton.setOnClickListener &#123;</span><br><span class="line">            myViewModel.incrementCounter()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="map和switchMap"><a href="#map和switchMap" class="headerlink" title="map和switchMap"></a>map和switchMap</h3><ul>
<li><p><strong>map</strong></p>
<ul>
<li><p>作用：将实际包含数据的LiveData和仅用于观察数据的LiveData进行转换</p>
</li>
<li><p>用法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span> : <span class="type">ViewModel</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _userName = MutableLiveData&lt;String&gt;()</span><br><span class="line">    <span class="keyword">val</span> userName: LiveData&lt;String&gt; <span class="keyword">get</span>() = _userName</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 map 将原始数据转换为需要的格式</span></span><br><span class="line">    <span class="keyword">val</span> userGreeting: LiveData&lt;String&gt; = userName.map &#123; name -&gt;</span><br><span class="line">        <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateUserName</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        _userName.value = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>switchMap</strong></p>
<ul>
<li><p>使用场景：当ViewModel中某个liveData对象是调用另外的方法获取的时候用switchMap</p>
</li>
<li><p>用法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span> : <span class="type">ViewModel</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _searchQuery = MutableLiveData&lt;String&gt;()</span><br><span class="line">    <span class="keyword">val</span> searchQuery: LiveData&lt;String&gt; <span class="keyword">get</span>() = _searchQuery</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 switchMap 来根据 searchQuery 触发新的搜索请求</span></span><br><span class="line">    <span class="keyword">val</span> searchResults: LiveData&lt;List&lt;String&gt;&gt; = searchQuery.switchMap &#123; query -&gt;</span><br><span class="line">        <span class="comment">// 假设搜索是一个异步操作，这里模拟为一个简单的列表</span></span><br><span class="line">        MutableLiveData&lt;List&lt;String&gt;&gt;().apply &#123;</span><br><span class="line">            value = listOf(<span class="string">&quot;Result for <span class="variable">$query</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateSearchQuery</span><span class="params">(query: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        _searchQuery.value = query</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>searchQuery</code> 是一个包含搜索关键字的 LiveData。</li>
<li><code>switchMap</code> 将每次更新的 <code>searchQuery</code> 映射到一个新的 LiveData（这里模拟为搜索结果）。</li>
<li>当 <code>searchQuery</code> 更新时，<code>switchMap</code> 会取消之前的查询并触发新的查询。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h1><h3 id="基本特征"><a href="#基本特征" class="headerlink" title="基本特征"></a>基本特征</h3><p><strong>Room</strong> 是 Jetpack 提供的一个数据库库，简化了 SQLite 的操作。它提供了一个抽象层，允许开发者更方便、更安全地访问本地数据库。Room 提供了注解（annotation）支持，结合 Kotlin 的数据类和架构组件，能够更高效地管理数据持久化操作。</p>
<p>Room 提供了一个 <strong>DAO（数据访问对象）</strong> 层来进行数据库操作，DAO 使用 SQL 查询语句来与数据库交互。Room 会在编译时生成实际的实现代码，减少了手动编写 SQL 语句的繁琐。</p>
<ul>
<li><strong>简单易用</strong>：相比直接使用 SQLite，Room 提供了更简单、类型安全的 API。</li>
<li><strong>SQLite 完全支持</strong>：它是基于 SQLite 的，可以执行 SQL 查询、插入、更新和删除操作。</li>
<li><strong>注解支持</strong>：使用注解定义数据库实体、DAO 和数据库版本。</li>
<li><strong>与 LiveData 兼容</strong>：Room 支持与 LiveData 结合使用，当数据改变时，Room 可以自动通知观察者。</li>
</ul>
<h3 id="添加依赖和插件"><a href="#添加依赖和插件" class="headerlink" title="添加依赖和插件"></a>添加依赖和插件</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kotlin(<span class="string">&quot;kapt&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;androidx.room:room-runtime:2.6.1&quot;</span>)  <span class="comment">// Room 的运行时库</span></span><br><span class="line">kapt(<span class="string">&quot;androidx.room:room-compiler:2.6.1&quot;</span>)  <span class="comment">// Room 的编译器，使用 KAPT 注解处理</span></span><br><span class="line">implementation(<span class="string">&quot;androidx.room:room-ktx:2.6.1&quot;</span>)  <span class="comment">// Room 的扩展库，提供了一些扩展函数和属性.</span></span><br></pre></td></tr></table></figure>

<h3 id="定义实体类-Entity"><a href="#定义实体类-Entity" class="headerlink" title="定义实体类(Entity)"></a>定义实体类(Entity)</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span> (<span class="keyword">var</span> firstName:String,<span class="keyword">var</span> lastName:String,<span class="keyword">var</span> age:<span class="built_in">Int</span>)&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey(autoGenerate = true)</span></span><br><span class="line">    <span class="keyword">var</span> id:<span class="built_in">Long</span>=<span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@Entity</strong> 注解标识这个类是一个数据库表。</li>
<li><strong>@PrimaryKey</strong> 注解指定主键，并可以设置 <code>autoGenerate = true</code> 让 Room 自动生成主键。</li>
</ul>
<h3 id="定义Dao"><a href="#定义Dao" class="headerlink" title="定义Dao"></a>定义Dao</h3><ul>
<li>Room关键部分，所有数据库操作均封装在这里</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Insert</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">insertUser</span><span class="params">(user:<span class="type">User</span>)</span></span>:<span class="built_in">Long</span></span><br><span class="line">    <span class="meta">@Update</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateUser</span><span class="params">(newUser: <span class="type">User</span>)</span></span></span><br><span class="line">    <span class="meta">@Query(<span class="string">&quot;select * from User&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loadAllUsers</span><span class="params">()</span></span>:List&lt;User&gt;</span><br><span class="line">    <span class="meta">@Query(<span class="string">&quot;select * from User where age&gt; :age&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loadUsersOlderThan</span><span class="params">(age:<span class="type">Int</span>)</span></span>:List&lt;User&gt;</span><br><span class="line">    <span class="meta">@Delete</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">deleteUser</span><span class="params">(user: <span class="type">User</span>)</span></span></span><br><span class="line">    <span class="meta">@Query(<span class="string">&quot;delete from User where lastName=:lastName&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">deleteUserByLastName</span><span class="params">(lastName:<span class="type">String</span>)</span></span>:<span class="built_in">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@Dao</strong> 注解标识这个接口是 DAO。</li>
<li><strong>@Insert</strong> 注解用于插入数据。</li>
<li><strong>@Query</strong> 注解定义 SQL 查询语句。</li>
<li><strong>@Update</strong>注解用于更新数据</li>
<li><strong>@Delete</strong>注解用于删除数据</li>
<li>利用非实体类参数来增删改数据时都要用**@Query**注解</li>
</ul>
<h3 id="定义数据库-Database"><a href="#定义数据库-Database" class="headerlink" title="定义数据库(Database)"></a>定义数据库(Database)</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(version = 1, entities = [User::class])</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AppDatabase</span>:<span class="type">RoomDatabase</span>()&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">userDao</span><span class="params">()</span></span>:UserDao</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> instance:AppDatabase?=<span class="literal">null</span></span><br><span class="line">        <span class="meta">@Synchronized</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getDatabase</span><span class="params">(context: <span class="type">Context</span>)</span></span>:AppDatabase&#123;</span><br><span class="line">            instance?.let &#123;</span><br><span class="line">                <span class="keyword">return</span>  it</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Room.databaseBuilder(context.applicationContext,AppDatabase::<span class="keyword">class</span>.java,<span class="string">&quot;app_database&quot;</span>          </span><br><span class="line">                .build().apply &#123;</span><br><span class="line">                    instance=<span class="keyword">this</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@Database</strong> 注解用于定义数据库，并指定包含的实体类和数据库版本，实体类之间用逗号隔开。</li>
<li><code>abstract fun userDao()</code> 方法提供对 DAO 的访问。</li>
<li>通过 <code>Room.databaseBuilder()</code> 方法获取数据库实例</li>
<li>由于数据库操作均为耗时操作故需要在子线程中进行</li>
</ul>
<h3 id="数据库升级"><a href="#数据库升级" class="headerlink" title="数据库升级"></a>数据库升级</h3><ol>
<li>更新版本和包含的实体类</li>
<li>实现 Migration的匿名类</li>
<li>构建实例时加入addMigrations方法</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(version = 3, entities = [User::class, Book::class])</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AppDatabase</span> : <span class="type">RoomDatabase</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * UserDao 是用于操作 User 实体的 DAO（Data Access Object）。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">userDao</span><span class="params">()</span></span>: UserDao</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * BookDao 是用于操作 Book 实体的 DAO（Data Access Object）。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">bookDao</span><span class="params">()</span></span>: BookDao</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Companion 对象用于存储数据库的迁移信息和实例。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * MIGRATION_1_2 是从数据库版本 1 到 2 的迁移。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">val</span> MIGRATION_1_2 = <span class="keyword">object</span> : Migration(<span class="number">1</span>, <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * migrate 方法用于执行从版本 1 到 2 的迁移。</span></span><br><span class="line"><span class="comment">             * 在这个例子中，我们创建了一个名为 Book 的新表。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">migrate</span><span class="params">(database: <span class="type">SupportSQLiteDatabase</span>)</span></span> &#123;</span><br><span class="line">                database.execSQL(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    CREATE TABLE Book (</span></span><br><span class="line"><span class="string">                        id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,</span></span><br><span class="line"><span class="string">                        name TEXT NOT NULL,</span></span><br><span class="line"><span class="string">                        pages INTEGER NOT NULL,</span></span><br><span class="line"><span class="string">                        author TEXT NOT NULL</span></span><br><span class="line"><span class="string">                    )</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>.trimIndent())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * MIGRATION_2_3 是从数据库版本 2 到 3 的迁移。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">val</span> MIGRATION_2_3 = <span class="keyword">object</span> : Migration(<span class="number">2</span>, <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * migrate 方法用于执行从版本 2 到 3 的迁移。</span></span><br><span class="line"><span class="comment">             * 在这个例子中，我们添加了一个名为 author 的新列到 User 表中。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">migrate</span><span class="params">(database: <span class="type">SupportSQLiteDatabase</span>)</span></span> &#123;</span><br><span class="line">                database.execSQL(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    ALTER TABLE User ADD COLUMN </span></span><br><span class="line"><span class="string">                    author TEXT NOT NULL DEFAULT &#x27;unknown&#x27;</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * instance 是 AppDatabase 的实例。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> instance: AppDatabase? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * getDatabase 方法用于获取 AppDatabase 的实例。</span></span><br><span class="line"><span class="comment">         * 如果实例已经存在，则直接返回实例。</span></span><br><span class="line"><span class="comment">         * 否则，则创建一个新的实例并返回。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Synchronized</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getDatabase</span><span class="params">(context: <span class="type">Context</span>)</span></span>: AppDatabase &#123;</span><br><span class="line">            instance?.let &#123; <span class="keyword">return</span> it &#125;</span><br><span class="line">            <span class="keyword">return</span> Room.databaseBuilder(</span><br><span class="line">                context.applicationContext,</span><br><span class="line">                AppDatabase::<span class="keyword">class</span>.java,</span><br><span class="line">                <span class="string">&quot;app_database&quot;</span></span><br><span class="line">            )</span><br><span class="line">                .addMigrations(MIGRATION_1_2, MIGRATION_2_3)</span><br><span class="line">                .build().apply &#123; instance = <span class="keyword">this</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="WorkManager"><a href="#WorkManager" class="headerlink" title="WorkManager"></a>WorkManager</h1><h3 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h3><p>处理一些要求定时执行的任务，可以根据操作系统的版本自动选择是使用AlarmManager还是JobScheduler实现。另外还能支持周期性任务，链式任务处理等功能。它很适合执行一些定期和服务器交互的任务，比如周期性的同步数据</p>
<h3 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h3><ol>
<li>添加依赖</li>
</ol>
   <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation (<span class="string">&quot;androidx.work:work-runtime:2.8.1&quot;</span>) <span class="comment">// Java</span></span><br><span class="line">    implementation (<span class="string">&quot;androidx.work:work-runtime-ktx:2.8.1&quot;</span>) <span class="comment">// Kotlin + Coroutines</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>定义后台任务并实现具体的任务逻辑</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleWorker</span>(context: Context,params:WorkerParameters):Worker(context,params) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWork</span><span class="params">()</span></span>: Result &#123;</span><br><span class="line">        <span class="comment">//编写具体的后台任务逻辑</span></span><br><span class="line">        Log.d(<span class="string">&quot;SimpleWorker&quot;</span>, <span class="string">&quot;do work in simpleworker&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>  Result.success()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>返回Result.success()表示成功</li>
<li>返回Result.failure()表示失败</li>
<li>返回Result.retry()也表示失败，只是可以结合WorkRequest.Builder的setBackoffCriteria()方法来重新执行任务</li>
</ul>
</li>
<li><p>配置该后台任务的运行条件和约束信息，并构建后台任务请求</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> workRequest = OneTimeWorkRequest.Builder(SimpleWorker::<span class="keyword">class</span>.java)</span><br><span class="line">    .build()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> periodicWorkRequest = PeriodicWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java, <span class="number">1</span>, TimeUnit.HOURS)</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>OneTimeWorkRequest</strong> 来执行一次性任务</li>
<li><strong>PeriodicWorkRequest</strong> 来执行定期任务。</li>
</ul>
</li>
<li><p>将该后台任务请求传入WorkManager的enqueue()的方法中，系统会在合适的时间运行</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(applicationContext).enqueue(workRequest)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="处理复杂任务"><a href="#处理复杂任务" class="headerlink" title="处理复杂任务"></a>处理复杂任务</h3><ul>
<li><p><strong>设置约束信息</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> workRequest = OneTimeWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java)</span><br><span class="line">	.setInitialDelay(<span class="number">5</span>,TimeUnit.MINUTES)</span><br><span class="line">    .addTag(<span class="string">&quot;simple&quot;</span>)</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>取消后台任务请求</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(applicationContext).cancelWorkByTag(<span class="string">&quot;simple&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(applicationContext).cancelWorkById(workRequest.id)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(applicationContext).cancelAllwork()<span class="comment">//一次性取消所有后台任务</span></span><br></pre></td></tr></table></figure>

<p>使用id只能取消单个任务，使用标签可以取消同一标签名的所有任务</p>
</li>
<li><p><strong>任务重试</strong></p>
<p>当doWork方法中返回Result.retry()时可以结合setBackoffCriteria方法重新执行任务</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一个参数指的是如果任务再次执行失败，下次重试的时间应以什么形式延迟</span></span><br><span class="line"><span class="keyword">val</span> workRequest = OneTimeWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java)</span><br><span class="line">    .setBackoffCriteria(BackoffPolicy.EXPONENTIAL, <span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">    .build()</span><br><span class="line"></span><br><span class="line">WorkManager.getInstance(applicationContext).enqueue(workRequest)</span><br></pre></td></tr></table></figure>
</li>
<li><h6 id="观察任务状态"><a href="#观察任务状态" class="headerlink" title="观察任务状态"></a><strong>观察任务状态</strong></h6><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">WorkManager.getInstance(applicationContext)</span><br><span class="line">    .getWorkInfoByIdLiveData(workRequest.id)</span><br><span class="line">    .observe(<span class="keyword">this</span>, Observer &#123; workInfo -&gt;</span><br><span class="line">        <span class="keyword">if</span> (workInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">when</span> (workInfo.state) &#123;</span><br><span class="line">                WorkInfo.State.SUCCEEDED -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 任务成功</span></span><br><span class="line">                &#125;</span><br><span class="line">                WorkInfo.State.FAILED -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 任务失败</span></span><br><span class="line">                &#125;</span><br><span class="line">                WorkInfo.State.RUNNING -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 任务正在运行</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                    <span class="comment">// 任务还未开始或已经完成</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>链式任务</strong></p>
</li>
</ul>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> firstRequest = OneTimeWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java).build()</span><br><span class="line"><span class="keyword">val</span> secondRequest = OneTimeWorkRequest.Builder(SecondWorker::<span class="keyword">class</span>.java).build()</span><br><span class="line"></span><br><span class="line">WorkManager.getInstance(applicationContext)</span><br><span class="line">    .beginWith(firstRequest)</span><br><span class="line">    .then(secondRequest)</span><br><span class="line">    .enqueue()</span><br></pre></td></tr></table></figure>

<p>  **注：**千万别依赖其去实现一些核心功能，它在国产手机上是不稳定的</p>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/25/Jetpack/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/06/16/%E7%BC%96%E5%86%99%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7/">
        <h2 class="post-title">编写好用的工具</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Kotlin/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Kotlin
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/16
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="求N个数的最大最小值"><a href="#求N个数的最大最小值" class="headerlink" title="求N个数的最大最小值"></a>求N个数的最大最小值</h3><p>使用泛型实现Comparable接口，可以适用于任意类型数字比较</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T:Comparable&lt;T&gt;</span>&gt; <span class="title">max</span><span class="params">(<span class="keyword">vararg</span> nums:<span class="type">T</span>)</span></span>:T&#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.isEmpty()) <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;Params can not be empty&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> maxNum=nums[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span>(num <span class="keyword">in</span> nums)&#123;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;maxNum)&#123;</span><br><span class="line">            maxNum=num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxNum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="简化Toast用法"><a href="#简化Toast用法" class="headerlink" title="简化Toast用法"></a>简化Toast用法</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串调用</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">showToast</span><span class="params">(context: <span class="type">Context</span>,duration: <span class="type">Int</span>=Toast.LENGTH_SHORT)</span></span>&#123;</span><br><span class="line">    Toast.makeText(context,<span class="keyword">this</span>,duration).show()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//资源id引用时调用</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Int</span>.<span class="title">showToast</span><span class="params">(context: <span class="type">Context</span>,duration: <span class="type">Int</span>=Toast.LENGTH_SHORT)</span></span>&#123;</span><br><span class="line">    Toast.makeText(context,<span class="keyword">this</span>,duration).show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="简化Snackbar用法"><a href="#简化Snackbar用法" class="headerlink" title="简化Snackbar用法"></a>简化Snackbar用法</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> View.<span class="title">showSnackbar</span><span class="params">(text:<span class="type">String</span>,actionText:<span class="type">String</span>?=<span class="literal">null</span>,duration:<span class="type">Int</span>=Snackbar.LENGTH_SHORT,block:(()-&gt;<span class="type">Unit</span>)?=<span class="literal">null</span>)</span></span>&#123;</span><br><span class="line">  <span class="keyword">val</span> snackbar=  Snackbar.make(<span class="keyword">this</span>,text,duration)</span><br><span class="line">    <span class="keyword">if</span>(actionText!=<span class="literal">null</span>&amp;&amp;block!=<span class="literal">null</span>)&#123;</span><br><span class="line">        snackbar.setAction(actionText)&#123;</span><br><span class="line">            block()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    snackbar.show()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> View.<span class="title">showSnackbar</span><span class="params">(resId:<span class="type">Int</span>,actionResId:<span class="type">Int</span>?=<span class="literal">null</span>,duration:<span class="type">Int</span>=Snackbar.LENGTH_SHORT,block:(()-&gt;<span class="type">Unit</span>)?=<span class="literal">null</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> snackbar=  Snackbar.make(<span class="keyword">this</span>,resId,duration)</span><br><span class="line">    <span class="keyword">if</span>(actionResId!=<span class="literal">null</span>&amp;&amp;block!=<span class="literal">null</span>)&#123;</span><br><span class="line">        snackbar.setAction(actionResId)&#123;</span><br><span class="line">            block()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    snackbar.show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用</span></span><br><span class="line">view.showSnackbar(<span class="string">&quot;this is Snackbar&quot;</span>,<span class="string">&quot;Action&quot;</span>)&#123;</span><br><span class="line">    <span class="comment">//具体逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/16/%E7%BC%96%E5%86%99%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/06/15/%E6%9C%80%E7%BE%8EUI%E4%BD%93%E9%AA%8C-Material-Design-Kotlin/">
        <h2 class="post-title">最美UI体验,Material Design(Kotlin)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Android-Kotlin%E7%89%88/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Android(Kotlin版)
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/15
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="各版块颜色的代表标识"><a href="#各版块颜色的代表标识" class="headerlink" title="各版块颜色的代表标识"></a>各版块颜色的代表标识</h1><p><img src="/../img/img59.jpg"></p>
<hr>
<h1 id="Toolbar"><a href="#Toolbar" class="headerlink" title="Toolbar"></a>Toolbar</h1><ul>
<li>在布局文件中使用</li>
<li>在活动中设置</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.appcompat.widget.Toolbar</span><br><span class="line">    android:id=<span class="string">&quot;@+id/toolbar&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;?attr/actionBarSize&quot;</span></span><br><span class="line">    android:background=<span class="string">&quot;?attr/colorPrimary&quot;</span></span><br><span class="line">    android:theme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span><br><span class="line">    app:popupTheme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span><span class="comment">//为弹出的菜单项设置主题</span></span><br><span class="line">    app:layout_scrollFlags=<span class="string">&quot;scroll|enterAlways|snap&quot;</span>/&gt;<span class="comment">//用于控制Toolbar或其他顶部栏的滚动行为</span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSupportActionBar(binding.toolbar)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="DrawerLayout"><a href="#DrawerLayout" class="headerlink" title="DrawerLayout"></a>DrawerLayout</h1><p>这是一个布局，允许放入两个直接子控件，第一个是主屏幕显示的内容，第二个是滑动菜单中显示的内容</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.drawerlayout.widget.DrawerLayout</span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:id=<span class="string">&quot;@+id/drawerLayout&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line">    &lt;FrameLayout</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span> &gt;</span><br><span class="line">	    &lt;androidx.appcompat.widget.Toolbar</span><br><span class="line">                android:id=<span class="string">&quot;@+id/toolbar&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;?attr/actionBarSize&quot;</span></span><br><span class="line">                android:background=<span class="string">&quot;@color/colorPrimary&quot;</span></span><br><span class="line">                android:theme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span><br><span class="line">                app:popupTheme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span><br><span class="line">                app:layout_scrollFlags=<span class="string">&quot;scroll|enterAlways|snap&quot;</span>/&gt;</span><br><span class="line">    &lt;/FrameLayout&gt;</span><br><span class="line">	&lt;TextView</span><br><span class="line"> 		android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">     	android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">		android:text=<span class="string">&quot;This is menu&quot;</span>/&gt;  	</span><br><span class="line">&lt;/androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用getSupportActionBar方法获取ActionBar实例</span></span><br><span class="line">        supportActionBar?.let &#123;</span><br><span class="line">            <span class="comment">//让导航按钮显示</span></span><br><span class="line">            it.setDisplayHomeAsUpEnabled(<span class="literal">true</span>)</span><br><span class="line">            <span class="comment">//设置导航图标</span></span><br><span class="line">            it.setHomeAsUpIndicator(R.drawable.ic_menu)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置按钮点击事件</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOptionsItemSelected</span><span class="params">(item: <span class="type">MenuItem</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">when</span>(item.itemId)&#123;</span><br><span class="line">            <span class="comment">//openDrawer将滑动菜单显示出来</span></span><br><span class="line">            android.R.id.home-&gt;binding.drawerLayout.openDrawer(GravityCompat.START)</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="NavigationView"><a href="#NavigationView" class="headerlink" title="NavigationView"></a>NavigationView</h1><p><strong>作用：</strong> NavigationView 用于在侧滑菜单中显示导航菜单项，可方便地配置菜单资源、头部布局等。</p>
<ul>
<li>依赖库</li>
<li>menu</li>
<li>headerLayout</li>
<li>点击事件</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;com.google.android.material:material:1.12.0&quot;</span>)</span><br><span class="line">implementation(<span class="string">&quot;de.hdodenhof:circleimageview:3.1.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;menu xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br><span class="line">    &lt;group android:checkableBehavior=<span class="string">&quot;single&quot;</span>&gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:id=<span class="string">&quot;@+id/navCall&quot;</span></span><br><span class="line">            android:icon=<span class="string">&quot;@drawable/nav_call&quot;</span></span><br><span class="line">            android:title=<span class="string">&quot;Call&quot;</span>/&gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:id=<span class="string">&quot;@+id/navFriends&quot;</span></span><br><span class="line">            android:icon=<span class="string">&quot;@drawable/nav_friends&quot;</span></span><br><span class="line">            android:title=<span class="string">&quot;Friends&quot;</span>/&gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:id=<span class="string">&quot;@+id/navLocation&quot;</span></span><br><span class="line">            android:icon=<span class="string">&quot;@drawable/nav_location&quot;</span></span><br><span class="line">            android:title=<span class="string">&quot;Location&quot;</span>/&gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:id=<span class="string">&quot;@+id/navMail&quot;</span></span><br><span class="line">            android:icon=<span class="string">&quot;@drawable/nav_mail&quot;</span></span><br><span class="line">            android:title=<span class="string">&quot;Mail&quot;</span>/&gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:id=<span class="string">&quot;@+id/navTask&quot;</span></span><br><span class="line">            android:icon=<span class="string">&quot;@drawable/nav_task&quot;</span></span><br><span class="line">            android:title=<span class="string">&quot;Task&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/group&gt;</span><br><span class="line">&lt;/menu&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;180dp&quot;</span></span><br><span class="line">    android:padding=<span class="string">&quot;10dp&quot;</span></span><br><span class="line">    android:background=<span class="string">&quot;@color/colorPrimary&quot;</span>&gt;</span><br><span class="line">    &lt;de.hdodenhof.circleimageview.CircleImageView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/iconImage&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;70dp&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;70dp&quot;</span></span><br><span class="line">        android:src=<span class="string">&quot;@drawable/nav_icon&quot;</span></span><br><span class="line">        android:layout_centerInParent=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/mailText&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_alignParentBottom=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;buyu@qq.com&quot;</span></span><br><span class="line">        android:textColor=<span class="string">&quot;#FFF&quot;</span></span><br><span class="line">        android:textSize=<span class="string">&quot;14sp&quot;</span>/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/userText&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_above=<span class="string">&quot;@id/mailText&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;Buyu&quot;</span></span><br><span class="line">        android:textColor=<span class="string">&quot;#FFF&quot;</span></span><br><span class="line">        android:textSize=<span class="string">&quot;14sp&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.material.navigation.NavigationView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/navView&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_gravity=<span class="string">&quot;start&quot;</span></span><br><span class="line">        app:menu=<span class="string">&quot;@menu/nav_menu&quot;</span></span><br><span class="line">        app:headerLayout=<span class="string">&quot;@layout/nav_header&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置默认选中项</span></span><br><span class="line">       binding.navView.setCheckedItem(R.id.navCall)</span><br><span class="line">       <span class="comment">//设置菜单项选中事件的监听器</span></span><br><span class="line">       binding.navView.setNavigationItemSelectedListener &#123;</span><br><span class="line">           <span class="comment">//将滑动菜单关闭</span></span><br><span class="line">           binding.main.closeDrawers()</span><br><span class="line">           <span class="comment">//true表示事件已处理</span></span><br><span class="line">           <span class="literal">true</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="FloatingActionButton"><a href="#FloatingActionButton" class="headerlink" title="FloatingActionButton"></a>FloatingActionButton</h1><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.material.floatingactionbutton.FloatingActionButton</span><br><span class="line">            android:id=<span class="string">&quot;@+id/fab&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_gravity=<span class="string">&quot;bottom|end&quot;</span></span><br><span class="line">            android:layout_margin=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:src=<span class="string">&quot;@drawable/ic_done&quot;</span></span><br><span class="line">            app:elevation=<span class="string">&quot;8dp&quot;</span>/&gt;<span class="comment">//指定高度值</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Snackbar"><a href="#Snackbar" class="headerlink" title="Snackbar"></a>Snackbar</h1><p><strong>作用：</strong> Snackbar 用于短暂地在屏幕底部显示信息反馈。虽然 Snackbar 主要在代码中调用显示，但其依赖于包含在布局中的 <code>CoordinatorLayout</code> 来获得自动动画和交互。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Snackbar.make(findViewById(R.id.coordinator_layout), <span class="string">&quot;这是一个Snackbar&quot;</span>, Snackbar.LENGTH_LONG)</span><br><span class="line">    .setAction(<span class="string">&quot;Undo&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 处理点击事件</span></span><br><span class="line">    &#125;</span><br><span class="line">    .show()</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="CoordinatorLayout"><a href="#CoordinatorLayout" class="headerlink" title="CoordinatorLayout"></a>CoordinatorLayout</h1><p>加强版的FrameLayout</p>
<p><strong>作用：</strong> CoordinatorLayout 是一个高级布局容器可以监听内部的所有控件，可以协调其内部子控件的交互,控件自动调整合适的位置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:id=<span class="string">&quot;@+id/coordinator_layout&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 这里可以嵌入 AppBarLayout、FloatingActionButton 等 --&gt;</span><br><span class="line">&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="MaterialCardView"><a href="#MaterialCardView" class="headerlink" title="MaterialCardView"></a>MaterialCardView</h1><p>额外提供了圆角阴影等效果的FrameLayout</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.material.card.MaterialCardView</span><br><span class="line">    android:id=<span class="string">&quot;@+id/material_card&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:layout_margin=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">    app:cardCornerRadius=<span class="string">&quot;8dp&quot;</span><span class="comment">//指定卡片圆角的弧度</span></span><br><span class="line">    app:elevation=<span class="string">&quot;4dp&quot;</span>&gt;<span class="comment">//指定卡片高度</span></span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片内部内容 --&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:padding=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;这是一个MaterialCardView&quot;</span> /&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/com.google.android.material.card.MaterialCardView&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="AppBarLayout"><a href="#AppBarLayout" class="headerlink" title="AppBarLayout"></a>AppBarLayout</h1><p><strong>作用：</strong> AppBarLayout 是用于实现应用栏（如 Toolbar、Tabs）的容器，它通常配合 CollapsingToolbarLayout 实现折叠效果。例如解决RecyclerView遮挡Toolbar问题</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.google.android.material.appbar.AppBarLayout</span><br><span class="line">    android:id=<span class="string">&quot;@+id/appbar_layout&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:theme=<span class="string">&quot;@style/AppTheme.AppBarOverlay&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">     &lt;androidx.appcompat.widget.Toolbar</span><br><span class="line">                android:id=<span class="string">&quot;@+id/toolbar&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;?attr/actionBarSize&quot;</span></span><br><span class="line">                android:background=<span class="string">&quot;@color/colorPrimary&quot;</span></span><br><span class="line">                android:theme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span><br><span class="line">                app:popupTheme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span><br><span class="line">                app:layout_scrollFlags=<span class="string">&quot;scroll|enterAlways|snap&quot;</span>/&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/com.google.android.material.appbar.AppBarLayout&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="SwipeRefreshLayout"><a href="#SwipeRefreshLayout" class="headerlink" title="SwipeRefreshLayout"></a>SwipeRefreshLayout</h1><p><strong>作用：</strong> SwipeRefreshLayout 用于实现下拉刷新效果，当用户下拉时可以触发刷新操作。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;androidx.swiperefreshlayout:swiperefreshlayout:1.1.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:id=<span class="string">&quot;@+id/swipe_refresh&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 包含可刷新的内容区域，例如 RecyclerView --&gt;</span><br><span class="line">    &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/recycler_view&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/androidx.swiperefreshlayout.widget.SwipeRefreshLayout&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="可折叠式标题栏"><a href="#可折叠式标题栏" class="headerlink" title="可折叠式标题栏"></a>可折叠式标题栏</h1><h3 id="CollapsingToolbarLayout"><a href="#CollapsingToolbarLayout" class="headerlink" title="CollapsingToolbarLayout"></a>CollapsingToolbarLayout</h3><p>不能独立存在必须是AppBarLayout子布局，AppBarLayout又必须是CoordinatorLayout子布局</p>
<p>这个高级标题栏就是普通标题栏加上背景图片</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    xmlns:app=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:fitsSystemWindows=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.google.android.material.appbar.AppBarLayout</span><br><span class="line">        android:id=<span class="string">&quot;@+id/appBar&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;250dp&quot;</span></span><br><span class="line">        android:fitsSystemWindows=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.google.android.material.appbar.CollapsingToolbarLayout</span><br><span class="line">            android:id=<span class="string">&quot;@+id/collapsingToolbar&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:theme=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span><br><span class="line">            android:fitsSystemWindows=<span class="string">&quot;true&quot;</span></span><br><span class="line">            app:contentScrim=<span class="string">&quot;?attr/colorPrimary&quot;</span></span><br><span class="line">            app:layout_scrollFlags=<span class="string">&quot;scroll|exitUntilCollapsed&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/fruitImageView&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:scaleType=<span class="string">&quot;centerCrop&quot;</span></span><br><span class="line">                android:fitsSystemWindows=<span class="string">&quot;true&quot;</span></span><br><span class="line">                app:layout_collapseMode=<span class="string">&quot;parallax&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;androidx.appcompat.widget.Toolbar</span><br><span class="line">                android:id=<span class="string">&quot;@+id/toolbar&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;?attr/actionBarSize&quot;</span></span><br><span class="line">                app:layout_collapseMode=<span class="string">&quot;pin&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/com.google.android.material.appbar.CollapsingToolbarLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/com.google.android.material.appbar.AppBarLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;androidx.core.widget.NestedScrollView</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        app:layout_behavior=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:orientation=<span class="string">&quot;vertical&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;com.google.android.material.card.MaterialCardView</span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_marginBottom=<span class="string">&quot;15dp&quot;</span></span><br><span class="line">                android:layout_marginLeft=<span class="string">&quot;15dp&quot;</span></span><br><span class="line">                android:layout_marginRight=<span class="string">&quot;15dp&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;35dp&quot;</span></span><br><span class="line">                app:cardCornerRadius=<span class="string">&quot;4dp&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">                &lt;TextView</span><br><span class="line">                    android:id=<span class="string">&quot;@+id/fruitContentText&quot;</span></span><br><span class="line">                    android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                    android:layout_margin=<span class="string">&quot;10dp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/com.google.android.material.card.MaterialCardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/androidx.core.widget.NestedScrollView&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.google.android.material.floatingactionbutton.FloatingActionButton</span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_margin=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">        android:src=<span class="string">&quot;@drawable/ic_comment&quot;</span></span><br><span class="line">        app:layout_anchor=<span class="string">&quot;@id/appBar&quot;</span></span><br><span class="line">        app:layout_anchorGravity=<span class="string">&quot;bottom|end&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure>

<h3 id="充分利用系统状态栏空间"><a href="#充分利用系统状态栏空间" class="headerlink" title="充分利用系统状态栏空间"></a>充分利用系统状态栏空间</h3><ul>
<li><strong>方案一</strong></li>
</ul>
<ol>
<li><p>将ImageView及其所有父布局使用android:fitsSystemWindows&#x3D;”true”</p>
</li>
<li><p>使用android:statusBarColor属性将主题状态栏颜色设为透明</p>
</li>
<li><p>在Manifest.xml中对活动主题进行修改</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=<span class="string">&quot;FruitActivityTheme&quot;</span> parent=<span class="string">&quot;AppTheme&quot;</span> &gt;</span><br><span class="line">        &lt;item name=<span class="string">&quot;android:statusBarColor&quot;</span>&gt;<span class="meta">@android</span>:color/transparent&lt;/item&gt;</span><br><span class="line">    &lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">            android:name=<span class="string">&quot;.FruitActivity&quot;</span></span><br><span class="line">            android:theme=<span class="string">&quot;@style/FruitActivityTheme&quot;</span>&gt;&lt;/activity&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p><strong>方案二</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> decorView=window.decorView</span><br><span class="line">decorView.systemUiVisibility=View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN or View.SYSTEM_UI_FLAG_LAYOUT_STABLE</span><br><span class="line">window.statusBarColor=Color.TRANSPARENT</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/15/%E6%9C%80%E7%BE%8EUI%E4%BD%93%E9%AA%8C-Material-Design-Kotlin/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/06/05/Kotlin%E4%BD%BF%E7%94%A8%E5%8D%8F%E7%A8%8B%E7%BC%96%E5%86%99%E9%AB%98%E6%95%88%E7%9A%84%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F/">
        <h2 class="post-title">Kotlin使用协程编写高效的并发程序</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Kotlin/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Kotlin
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/5
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="协程的基本用法"><a href="#协程的基本用法" class="headerlink" title="协程的基本用法"></a>协程的基本用法</h3><ul>
<li><p><strong>优点</strong></p>
<p>协程允许我们在单线程模式下模拟多线程编程的效果</p>
</li>
<li><p><strong>依赖库</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gradle 依赖</span></span><br><span class="line">implementation(<span class="string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.8.0&quot;</span>)</span><br><span class="line"><span class="comment">//Android扩展</span></span><br><span class="line">implementation(<span class="string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.8.0&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Global.launch函数创建协程作用域</strong></p>
<ul>
<li>Global.launch创建的是一个顶层协程，这种协程当应用程序结束时也会跟着结束</li>
<li>使用Thread.sleep可以让主线程堵塞一定时长</li>
<li>delay()可以让当前协程延长指定时间后再运行，是一个非阻塞式的挂起函数，只会挂起当前协程，对其他线程或协程无影响</li>
<li>最大的问题就是可能代码还没运行结束应用程序就结束了，代码运行强制中断</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GlobalScope.launch &#123;</span><br><span class="line">       println(<span class="string">&quot;codes run in coroutine scope&quot;</span>)</span><br><span class="line">       delay(<span class="number">1500</span>)</span><br><span class="line">       println(<span class="string">&quot;codes run in coroutine scope finished&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   Thread.sleep(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>runBlocking函数</strong></p>
<ul>
<li>可以保证作用域内所有代码和子线程未执行完之前一直阻塞当前线程</li>
<li><strong>需要注意</strong>runBlocking 一般只在测试环境使用，正式环境容易出现性能问题</li>
<li>可以在作用域中使用launch函数创建多个协程</li>
<li><strong>子线程的特点</strong>如果外层作用域协程结束子线程也会结束</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">runBlocking &#123;</span><br><span class="line">            launch &#123;</span><br><span class="line">                println(<span class="string">&quot;launch1&quot;</span>)</span><br><span class="line">                delay(<span class="number">1000</span>)</span><br><span class="line">                println(<span class="string">&quot;launch1 finished&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            launch &#123;</span><br><span class="line">                println(<span class="string">&quot;launch2&quot;</span>)</span><br><span class="line">                delay(<span class="number">1000</span>)</span><br><span class="line">                println(<span class="string">&quot;launch2 finished&quot;</span>)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>suspend关键字</strong></p>
<ul>
<li>可以将任何函数声明成挂起函数</li>
<li>无法提供协程作用域</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">printDot</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>coroutineScope函数</strong></p>
<p>会继承外部的协程的作用域并创建一个子协程</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">printDot</span><span class="params">()</span></span>=coroutineScope&#123;</span><br><span class="line">    launch&#123;</span><br><span class="line">    println(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>coroutineScope函数和runBlocking函数的区别</strong></p>
<ul>
<li>coroutineScope将外部协程挂起，当作用域内代码执行完毕coroutineScope函数之后的代码才可以执行</li>
<li>coroutineScope函数只会阻塞当前线程既不影响其他协程又不影响其他线程，因此不会造成任何性能上的问题</li>
<li>runBlocking会造成性能上的问题，不推荐在项目中使用</li>
</ul>
</li>
</ul>
<hr>
<h3 id="更多的作用域构建器"><a href="#更多的作用域构建器" class="headerlink" title="更多的作用域构建器"></a>更多的作用域构建器</h3><ul>
<li><p><strong>实际项目中常用写法</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> job=Job()</span><br><span class="line"><span class="keyword">val</span> scope=CoroutineScope(job)</span><br><span class="line">scope.launch&#123;</span><br><span class="line">    <span class="comment">//处理具体逻辑</span></span><br><span class="line">&#125;</span><br><span class="line">job.cancel()</span><br></pre></td></tr></table></figure>

<p>这样创建所有调用CoroutineScope的launch函数所创建的协程，都会被关联在Job对象作用域下，这样只需调用一次cancel就可以将同一作用域内的所有协程全部取消</p>
</li>
<li><p><strong>async获取执行结果</strong></p>
<ul>
<li>async必须在协程作用域中调用</li>
<li>创建一个新的协程并返回一个Deferred对象，并调用await()方法获取结果</li>
<li>在最后一起调用await方法可以大大提高效率，会使两个async函数变为并行关系</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">/*runBlocking &#123;</span></span><br><span class="line"><span class="comment">        val result=async &#123;</span></span><br><span class="line"><span class="comment">            5+5</span></span><br><span class="line"><span class="comment">        &#125;.await()</span></span><br><span class="line"><span class="comment">        println(result)</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    runBlocking &#123;</span><br><span class="line">        <span class="keyword">val</span> result1=async &#123;</span><br><span class="line">            <span class="number">5</span>+<span class="number">5</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> result2=async &#123;</span><br><span class="line">            <span class="number">4</span>+<span class="number">6</span></span><br><span class="line">        &#125;</span><br><span class="line">        println(<span class="string">&quot;result is <span class="subst">$&#123;result1.await()+result2.await()&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>withContext()函数(async函数的简化版)</strong></p>
<ul>
<li>当代码全部执行完会将最后一行结果作为返回值返回</li>
<li>强制要求指定一个线程参数</li>
<li>线程参数有三个可选值：Dispatchers.Default,Dispatchers.IO和Dispatchers.Main.Dispatchers.Default表示默认低并发策略，当执行代码属于计算密集型任务时，开启过高的并发反而影响效率。Dispatchers.IO表示较高并发的线程策略，执行代码大多数时间在阻塞和等待中。Dispatchers.Main表示不会开启子线程，但这个值只能在Android项目中使用，纯Kotlin程序中使用会出错。</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    runBlocking &#123;</span><br><span class="line">        <span class="keyword">val</span> result= withContext(Dispatchers.Default)&#123;</span><br><span class="line">            <span class="number">5</span>+<span class="number">5</span></span><br><span class="line">        &#125;</span><br><span class="line">        println(result)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="使用协程简化回调方法"><a href="#使用协程简化回调方法" class="headerlink" title="使用协程简化回调方法"></a>使用协程简化回调方法</h3><ul>
<li><p><strong>发送网络请求的回调</strong></p>
<ul>
<li>suspendCoroutine函数必须在协程作用域或挂起函数中才能调用，主要作用是把当前协程立刻挂起，然后在普通线程中执行lambda表达式代码</li>
<li>Lambda表达式会传入continuation参数，调用他的resume方法或resumeWithException方法可以使协程恢复</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">suspend</span>  <span class="function"><span class="keyword">fun</span> <span class="title">request</span><span class="params">(adress:<span class="type">String</span>)</span></span>:String&#123;</span><br><span class="line">        <span class="keyword">return</span> suspendCoroutine &#123;</span><br><span class="line">            continuation -&gt;</span><br><span class="line">           HttpUtil.sendRequestWithHttpURLConnection(adress,<span class="keyword">object</span>:HttpCallbackListener&#123;</span><br><span class="line">               <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFinish</span><span class="params">(response: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">                   continuation.resume(response)</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="type">Exception</span>)</span></span> &#123;</span><br><span class="line">                   continuation.resumeWithException(e)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">    <span class="keyword">suspend</span>  <span class="function"><span class="keyword">fun</span> <span class="title">getBaiduResponse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">val</span> response=request(<span class="string">&quot;http://www.baidu.com/&quot;</span>)</span><br><span class="line">            <span class="comment">//对服务器响应数据进行处理</span></span><br><span class="line">        &#125;<span class="keyword">catch</span>(e:Exception)&#123;</span><br><span class="line">            <span class="comment">//对异常情况处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Retrofit发送请求的回调</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span><span class="type">&lt;T&gt;</span> Call<span class="type">&lt;T&gt;</span>.<span class="title">await</span><span class="params">()</span></span>:T&#123;</span><br><span class="line">    <span class="keyword">return</span> suspendCoroutine&#123;continuation -&gt;</span><br><span class="line">                            enqueue(<span class="keyword">object</span>:Callback&lt;T&gt;&#123;</span><br><span class="line">                                 <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">                    call: <span class="type">Call</span>&lt;<span class="type">T</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">                    response: <span class="type">Response</span>&lt;<span class="type">T</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">                )</span></span> &#123;</span><br><span class="line">                  <span class="keyword">val</span> body=response.body()</span><br><span class="line">                  <span class="keyword">if</span>(body!=<span class="literal">null</span>)&#123;</span><br><span class="line">                      continuation.resume(body)</span><br><span class="line">                  &#125; </span><br><span class="line">                 <span class="keyword">else</span>   continuation.resumeWithException(</span><br><span class="line">                     RuntimeException(<span class="string">&quot;response body is null&quot;</span>)</span><br><span class="line">                 )                 </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(call: <span class="type">Call</span>&lt;<span class="type">T</span>&gt;, t:<span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">                  continuation.resumeWithException(t)</span><br><span class="line">                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAppData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">val</span> appList=ServiceCreator.create&lt;AppService&gt;().getAppData().await()</span><br><span class="line">        <span class="comment">//对服务器响应的数据进行处理</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(e:Exception)&#123;</span><br><span class="line">        <span class="comment">//对异常进行处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/05/Kotlin%E4%BD%BF%E7%94%A8%E5%8D%8F%E7%A8%8B%E7%BC%96%E5%86%99%E9%AB%98%E6%95%88%E7%9A%84%E5%B9%B6%E5%8F%91%E7%A8%8B%E5%BA%8F/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/06/04/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/">
        <h2 class="post-title">网络技术(Kotlin)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Android-Kotlin%E7%89%88/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Android(Kotlin版)
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/6/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h1><ol>
<li><p>使用WebView控件</p>
</li>
<li><p>调用getSettings方法设置浏览器属性</p>
</li>
<li><p>传入WebViewClient实例</p>
</li>
<li><p>传入网址</p>
</li>
<li><p>声明网络权限</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;WebView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/webView&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding:ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        binding.webView.settings.javaScriptEnabled=<span class="literal">true</span></span><br><span class="line">        <span class="comment">//当需要从一个网页跳转到另一个网页时，目标网页仍在WebView中展示，而不是打开系统浏览器</span></span><br><span class="line">        binding.webView.webViewClient= WebViewClient()</span><br><span class="line">        binding.webView.loadUrl(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="使用HTTP访问网络"><a href="#使用HTTP访问网络" class="headerlink" title="使用HTTP访问网络"></a>使用HTTP访问网络</h1><h3 id="HttpURLConnection"><a href="#HttpURLConnection" class="headerlink" title="HttpURLConnection"></a>HttpURLConnection</h3><ol>
<li>获取HttpURLConnection实例</li>
<li>设置请求方法</li>
<li>自由定制一些功能</li>
<li>得到从服务器返回的输入流，并对输入流进行读取</li>
<li>将HTTP连接关闭</li>
<li>记得声明权限</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        binding= ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        binding.sendRequest.setOnClickListener &#123;</span><br><span class="line">            sendRequestWithHttpURLConnection()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sendRequestWithHttpURLConnection</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//开启线程发送网络请求</span></span><br><span class="line">        thread &#123;</span><br><span class="line">            <span class="keyword">var</span> connection:HttpURLConnection?=<span class="literal">null</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> response=StringBuilder()</span><br><span class="line">                <span class="keyword">val</span> url=URL(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">                connection=url.openConnection() <span class="keyword">as</span> HttpURLConnection</span><br><span class="line">                connection.connectTimeout=<span class="number">8000</span></span><br><span class="line">                connection.readTimeout=<span class="number">8000</span></span><br><span class="line">                <span class="keyword">val</span> input=connection.inputStream</span><br><span class="line">                <span class="comment">//下面对获取到的输入流进行读取</span></span><br><span class="line">                <span class="keyword">val</span> reader=BufferedReader(InputStreamReader(input))</span><br><span class="line">                reader.use &#123;</span><br><span class="line">                    reader.forEachLine &#123;</span><br><span class="line">                        response.append(it)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                showResponse(response.toString())</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//断开连接</span></span><br><span class="line">                connection?.disconnect()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showResponse</span><span class="params">(response: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        runOnUiThread &#123;</span><br><span class="line">            <span class="comment">//在这里进行UI操作，将结果显示到界面上</span></span><br><span class="line">            binding.responseText.text=response</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用OkHttp"><a href="#使用OkHttp" class="headerlink" title="使用OkHttp"></a>使用OkHttp</h3><p><strong>发送GET请求</strong></p>
<ol>
<li><p>安装依赖库</p>
</li>
<li><p>创建一个OkHttpClient()实例</p>
</li>
<li><p>创建Request对象，通过连缀丰富对象</p>
</li>
<li><p>通过newCall方法获取Call对象，并调用execute方法发送请求并获取服务器返回的数据</p>
</li>
<li><p>得到返回数据的具体内容</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;com.squareup.okhttp3:okhttp:4.11.0&quot;</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sendRequestWithOkHttp</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="comment">//开启线程发送网络请求</span></span><br><span class="line">       thread &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="keyword">val</span> client=OkHttpClient()</span><br><span class="line">               <span class="keyword">val</span> request=Request.Builder()</span><br><span class="line">                   .url(<span class="string">&quot;https://www.baidu.com&quot;</span>)                </span><br><span class="line">                   .build()</span><br><span class="line">               <span class="keyword">val</span> response=client.newCall(request).execute()</span><br><span class="line">               <span class="keyword">val</span> responseData=response.body?.string()</span><br><span class="line">               <span class="keyword">if</span> (responseData!=<span class="literal">null</span>)&#123;</span><br><span class="line">                   showResponse(responseData)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">               e.printStackTrace()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>发送POST请求</strong></p>
<ol>
<li><p>安装依赖库</p>
</li>
<li><p>创建一个OkHttpClient()实例</p>
</li>
<li><p>创建一个RequestBody对象</p>
</li>
<li><p>创建Request对象，并调用post方法，通过连缀丰富对象</p>
</li>
<li><p>通过newCall方法获取Call对象，并调用execute方法发送请求并获取服务器返回的数据</p>
</li>
<li><p>得到返回数据的具体内容</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&quot;com.squareup.okhttp3:okhttp:4.11.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sendRequestWithOkHttp</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="comment">//开启线程发送网络请求</span></span><br><span class="line">       thread &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="keyword">val</span> client=OkHttpClient()</span><br><span class="line">               <span class="keyword">val</span> requestBody=FormBody.Builder()</span><br><span class="line">                   .add(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">               	.add(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">               	.build()</span><br><span class="line">               <span class="keyword">val</span> request=Request.Builder()</span><br><span class="line">                   .url(<span class="string">&quot;https://www.baidu.com&quot;</span>)   </span><br><span class="line">               	.post(requestBody)</span><br><span class="line">                   .build()</span><br><span class="line">               <span class="keyword">val</span> response=client.newCall(request).execute()</span><br><span class="line">               <span class="keyword">val</span> responseData=response.body?.string()</span><br><span class="line">               <span class="keyword">if</span> (responseData!=<span class="literal">null</span>)&#123;</span><br><span class="line">                   showResponse(responseData)</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">               e.printStackTrace()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="解析XML数据"><a href="#解析XML数据" class="headerlink" title="解析XML数据"></a>解析XML数据</h1><h3 id="Pull解析方式"><a href="#Pull解析方式" class="headerlink" title="Pull解析方式"></a>Pull解析方式</h3><ol>
<li><p>创建XmlPullParserFactory实例,并得到得到XmlPullParser对象</p>
</li>
<li><p>将服务器返回的XML数据设置进去</p>
</li>
<li><p>开始解析，用geteventType()得到当前解析的事件</p>
</li>
<li><p>在while循环中不断进行解析，调用next获得下一个解析事件</p>
</li>
<li><p>在循环内通过getName获得名字，用nextText获取具体内容</p>
</li>
<li><p>为了让程序可以使用HTTP，还要在xml文件中添加配置</p>
</li>
<li><p>在AndroidManifest中启动配置文件</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">parseXMLWithPull</span><span class="params">(xmlData:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="comment">//创建XmlPullParserFactory实例</span></span><br><span class="line">               <span class="keyword">val</span> factory=XmlPullParserFactory.newInstance()</span><br><span class="line">               <span class="comment">//借助XmlPullParserFactory实例得到XmlPullParser对象</span></span><br><span class="line">               <span class="keyword">val</span> xmlPullParser=factory.newPullParser()</span><br><span class="line">               <span class="comment">//将服务器返回的XML数据设置进去</span></span><br><span class="line">               xmlPullParser.setInput(StringReade r(xmlData))</span><br><span class="line">               <span class="comment">//开始解析</span></span><br><span class="line">               <span class="comment">//用geteventType()得到当前解析的事件</span></span><br><span class="line">               <span class="keyword">var</span> eventType=xmlPullParser.eventType</span><br><span class="line">               <span class="keyword">var</span> id=<span class="string">&quot;&quot;</span></span><br><span class="line">               <span class="keyword">var</span> name=<span class="string">&quot;&quot;</span></span><br><span class="line">               <span class="keyword">var</span> version=<span class="string">&quot;&quot;</span></span><br><span class="line">               <span class="comment">//当eventType!=XmlPullParser.END_DOCUMENT说明解析工作还未完成</span></span><br><span class="line">               <span class="keyword">while</span>(eventType!=XmlPullParser.END_DOCUMENT)&#123;</span><br><span class="line">                   <span class="comment">//通过getName得到当前节点的名字</span></span><br><span class="line">                   <span class="keyword">val</span> nodeName=xmlPullParser.name</span><br><span class="line">                   <span class="keyword">when</span> (eventType) &#123;</span><br><span class="line">                       <span class="comment">//开始解析某节点</span></span><br><span class="line">                       XmlPullParser.START_TAG-&gt;&#123;</span><br><span class="line">                           <span class="keyword">when</span>(nodeName)&#123;</span><br><span class="line">                                <span class="comment">//通过nextText()获取节点具体内容</span></span><br><span class="line">                               <span class="string">&quot;id&quot;</span>-&gt;id=xmlPullParser.nextText()</span><br><span class="line">                               <span class="string">&quot;name&quot;</span>-&gt;name=xmlPullParser.nextText()</span><br><span class="line">                               <span class="string">&quot;version&quot;</span>-&gt;version=xmlPullParser.nextText()</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                       <span class="comment">//完成解析某个节点</span></span><br><span class="line">                       XmlPullParser.END_TAG-&gt;&#123;</span><br><span class="line">                           <span class="keyword">if</span>(<span class="string">&quot;app&quot;</span>==nodeName)&#123;</span><br><span class="line">                               Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is <span class="variable">$id</span>&quot;</span>)</span><br><span class="line">                               Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">                               Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is <span class="variable">$version</span>&quot;</span>)</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="comment">//调用next()方法获取下一个解析事件</span></span><br><span class="line">                   eventType=xmlPullParser.next()</span><br><span class="line">   </span><br><span class="line">               &#125;</span><br><span class="line">           &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">               e.printStackTrace()</span><br><span class="line">           &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;network-security-config&gt;</span><br><span class="line">    &lt;base-config cleartextTrafficPermitted=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;trust-anchors&gt;</span><br><span class="line">            &lt;certificates src=<span class="string">&quot;system&quot;</span>/&gt;</span><br><span class="line">        &lt;/trust-anchors&gt;</span><br><span class="line">    &lt;/base-config&gt;</span><br><span class="line">&lt;/network-security-config&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:networkSecurityConfig=<span class="string">&quot;@xml/neiwork_config&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="SAX解析方式"><a href="#SAX解析方式" class="headerlink" title="SAX解析方式"></a>SAX解析方式</h3><ol>
<li>新建一个类继承DefaultHandler,并重写五种方法</li>
<li>创建SAXParserFactory实例</li>
<li>获取XMLReader对象</li>
<li>将编写的实例类设置到XMLReader中</li>
<li>调用parse方法开始执行</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyHandle</span>:<span class="type">DefaultHandler</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> nodeName=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> id:StringBuilder</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> name:StringBuilder</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> version:StringBuilder</span><br><span class="line">    <span class="comment">//开始XML解析时调用</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">startDocument</span><span class="params">()</span></span> &#123;</span><br><span class="line">        id=StringBuilder()</span><br><span class="line">        name=StringBuilder()</span><br><span class="line">        version=StringBuilder()</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//开始解析某个节点时调用</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">startElement</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        uri: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        localName: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        qName: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        attributes: <span class="type">Attributes</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="comment">// localName记录当前节点名称</span></span><br><span class="line">        nodeName= localName!!</span><br><span class="line">        Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;uri is <span class="variable">$uri</span>&quot;</span>)</span><br><span class="line">        Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;localName is <span class="variable">$localName</span>&quot;</span>)</span><br><span class="line">        Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;qName is <span class="variable">$qName</span>&quot;</span>)</span><br><span class="line">        Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;attributes is <span class="variable">$attributes</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//获取节点内内容时调用</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">characters</span><span class="params">(ch: <span class="type">CharArray</span>?, start: <span class="type">Int</span>, length: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">//根据当前节点名判断加到哪个StringBuilder对象中</span></span><br><span class="line">        <span class="keyword">when</span>(nodeName)&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>-&gt;id.append(ch,start,length)</span><br><span class="line">            <span class="string">&quot;name&quot;</span>-&gt;name.append(ch,start,length)</span><br><span class="line">            <span class="string">&quot;version&quot;</span>-&gt;version.append(ch,start,length)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//完成解析某个节点时调用</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">endElement</span><span class="params">(uri: <span class="type">String</span>?, localName: <span class="type">String</span>?, qName: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;app&quot;</span>==localName)&#123;</span><br><span class="line">            <span class="comment">//trim()方法是用于去除字符串两端的空白字符</span></span><br><span class="line">            Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;id is <span class="subst">$&#123;id.toString().trim()&#125;</span> &quot;</span>)</span><br><span class="line">            Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;name is <span class="subst">$&#123;name.toString().trim()&#125;</span> &quot;</span>)</span><br><span class="line">            Log.d(<span class="string">&quot;MyHandle&quot;</span>, <span class="string">&quot;version is <span class="subst">$&#123;version.toString().trim()&#125;</span> &quot;</span>)</span><br><span class="line">            <span class="comment">//最后将StringBuilder内容清空</span></span><br><span class="line">            id.setLength(<span class="number">0</span>)</span><br><span class="line">            name.setLength(<span class="number">0</span>)</span><br><span class="line">            version.setLength(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//完成xml解析时调用</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">endDocument</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.endDocument()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">parseXMLWithSAX</span><span class="params">(xmlData: <span class="type">String</span>)</span></span> = <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> factory=SAXParserFactory.newInstance()</span><br><span class="line">        <span class="keyword">val</span> xmlReader=factory.newSAXParser().xmlReader</span><br><span class="line">        <span class="keyword">val</span> handler= MyHandle()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将MyHandle的实例设置到XMLReader中</span></span><br><span class="line">        xmlReader.contentHandler=handler</span><br><span class="line">        <span class="comment">//开始执行解析</span></span><br><span class="line">        xmlReader.parse(InputSource(StringReader(xmlData)))</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="解析JSON格式数据"><a href="#解析JSON格式数据" class="headerlink" title="解析JSON格式数据"></a>解析JSON格式数据</h1><h3 id="使用JSONObject"><a href="#使用JSONObject" class="headerlink" title="使用JSONObject"></a>使用JSONObject</h3><ol>
<li>定义一个数组，将返回的数据传入到JSONArray对象中</li>
<li>循环遍历数组，取出各个元素</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">parseJSONWithJSONObject</span><span class="params">(jsonData: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//定义一个JSON数组</span></span><br><span class="line">            <span class="keyword">val</span> jsonArray=JSONArray(jsonData)</span><br><span class="line">            <span class="comment">//循环遍历</span></span><br><span class="line">            <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until jsonArray.length())&#123;</span><br><span class="line">                <span class="comment">//取出元素，每个取出的元素都是一个jsonObject对象</span></span><br><span class="line">                <span class="keyword">val</span> jsonObject=jsonArray.getJSONObject(i)</span><br><span class="line">                <span class="keyword">val</span> id=jsonObject.getString(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                <span class="keyword">val</span> name=jsonObject.getString(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                <span class="keyword">val</span> version=jsonObject.getString(<span class="string">&quot;version&quot;</span>)</span><br><span class="line">                Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is <span class="variable">$id</span>&quot;</span>)</span><br><span class="line">                Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">                Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is <span class="variable">$version</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="使用GSON"><a href="#使用GSON" class="headerlink" title="使用GSON"></a>使用GSON</h3><p><strong>优点</strong>：可以将一段JSON格式的字符串自动映射成一个对象，不需要再手动编写代码解析</p>
<ol>
<li>添加依赖库</li>
<li>获取Gson对象</li>
<li>如果是一个JSON数据，可以调用fromJson方法，如果是一段Json数组需要借助TypeToken将期望解析成的数据类型传入fromJson方法</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation (<span class="string">&quot;com.google.code.gson:gson:2.10.1&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">parseJSONWithGSON</span><span class="params">(jsonData: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">       <span class="keyword">val</span> gson=Gson()</span><br><span class="line">       <span class="keyword">val</span> typeOf=<span class="keyword">object</span> :TypeToken&lt;List&lt;App&gt;&gt;() &#123;&#125;.type</span><br><span class="line">       <span class="keyword">val</span> appList=gson.fromJson&lt;List&lt;App&gt;&gt;(jsonData,typeOf)</span><br><span class="line">       <span class="keyword">for</span>(app <span class="keyword">in</span> appList)&#123;</span><br><span class="line">           Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is <span class="subst">$&#123;app.id&#125;</span>&quot;</span>)</span><br><span class="line">           Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is <span class="subst">$&#123;app.name&#125;</span>&quot;</span>)</span><br><span class="line">           Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is <span class="subst">$&#123;app.version&#125;</span>&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="网络请求回调的实现方式"><a href="#网络请求回调的实现方式" class="headerlink" title="网络请求回调的实现方式"></a>网络请求回调的实现方式</h1><p><strong>采用回调的原因</strong>：所有耗时逻辑在子线程中进行，sendHttpRequest()方法在服务器还没来得及响应的时候就执行结束</p>
<h3 id="HttpURLConnection方法"><a href="#HttpURLConnection方法" class="headerlink" title="HttpURLConnection方法"></a>HttpURLConnection方法</h3><ol>
<li><p>将请求方法放入到单例类中</p>
</li>
<li><p>定义一个接口，并定义方法</p>
</li>
<li><p>给方法添加一个接口参数，并开启一个子线程</p>
</li>
<li><p>在线程中回调接口方法</p>
</li>
<li><p>调用sendRequestWithHttpURLConnection()方法，调用时还需将接口实例传入</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">HttpCallbackListener</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onFinish</span><span class="params">(response:<span class="type">String</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="type">Exception</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> HttpUtil &#123;</span><br><span class="line">     <span class="function"><span class="keyword">fun</span> <span class="title">sendRequestWithHttpURLConnection</span><span class="params">(adress: <span class="type">String</span>, listener: <span class="type">HttpCallbackListener</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">//开启线程发送网络请求</span></span><br><span class="line">        thread &#123;</span><br><span class="line">            <span class="keyword">var</span> connection: HttpURLConnection? = <span class="literal">null</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> response = StringBuilder()</span><br><span class="line">                <span class="keyword">val</span> url = URL(adress)</span><br><span class="line">                connection = url.openConnection() <span class="keyword">as</span> HttpURLConnection</span><br><span class="line">                connection.connectTimeout = <span class="number">8000</span></span><br><span class="line">                connection.readTimeout = <span class="number">8000</span></span><br><span class="line">                <span class="keyword">val</span> input = connection.inputStream</span><br><span class="line">                <span class="comment">//下面对获取到的输入流进行读取</span></span><br><span class="line">                <span class="keyword">val</span> reader = BufferedReader(InputStreamReader(input))</span><br><span class="line">                reader.use &#123;</span><br><span class="line">                    reader.forEachLine &#123;</span><br><span class="line">                        response.append(it)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//回调onFinish()方法</span></span><br><span class="line">                listener.onFinish(response.toString())</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                <span class="comment">//回调onError方法</span></span><br><span class="line">                listener.onError(e)</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                connection?.disconnect()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HttpUtil.sendRequestWithHttpURLConnection(adress,<span class="keyword">object</span>:HttpCallbackListener&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFinish</span><span class="params">(response:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">        <span class="comment">//得到服务器返回的具体内容</span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e:<span class="type">Exception</span>)</span></span>&#123;</span><br><span class="line">        <span class="comment">//在这里对异常情况进行处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="OkHttp方法"><a href="#OkHttp方法" class="headerlink" title="OkHttp方法"></a>OkHttp方法</h3><ol>
<li>将请求方法放入到单例类中</li>
<li>传入okhttp3.Callback参数，这是oKHttp库自带的回调接口</li>
<li>在newCall后调用enqueue方法，并传入接口参数</li>
<li>调用sendRequestWithOkHttp()方法</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sendRequestWithOkHttp</span><span class="params">(adress: <span class="type">String</span>, callback: <span class="type">okhttp3</span>.<span class="type">Callback</span>)</span></span> &#123;</span><br><span class="line">       <span class="keyword">val</span> client = OkHttpClient()</span><br><span class="line">       <span class="keyword">val</span> request = Request.Builder()</span><br><span class="line">           .url(adress)</span><br><span class="line">           .build()</span><br><span class="line">       <span class="comment">//enqueue()内部帮我们开好了子线程，然后子线程中执行Http请求</span></span><br><span class="line">    client.newCall(request).enqueue(callback)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HttpUtil.sendRequestWithOkHttp(adress,<span class="keyword">object</span>:Callback&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(call:<span class="type">Call</span>,response:<span class="type">Response</span>)</span></span>&#123;</span><br><span class="line">        <span class="comment">//得到服务器返回的具体内容</span></span><br><span class="line">        <span class="keyword">val</span> responseData=response.body?.string()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(call:<span class="type">Call</span>,e:<span class="type">IOException</span>)</span></span>&#123;</span><br><span class="line">         <span class="comment">//在这里对异常情况进行处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="最好用的网络库：Retrofit"><a href="#最好用的网络库：Retrofit" class="headerlink" title="最好用的网络库：Retrofit"></a>最好用的网络库：Retrofit</h1><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><ol>
<li><p>添加依赖库</p>
</li>
<li><p>定义接口，使用@GET注解表示调用方法时Retrofit会发起一条GET请求，请求地址就是注解中传入的具体参数</p>
</li>
<li><p>构建Retrofit对象,baseUrl用于指定所以Retrofit请求的根路径,addConverterFactory用于指定Retrofit在解析数据时所使用的转换库，这俩方法必须调用</p>
</li>
<li><p>创建接口的动态代理对象</p>
</li>
<li><p>调用接口方法返回一个Call&lt;List<App>&gt;对象，再调用它enqueue方法（发送请求时Retrofit会自动在内部开启线程，整个操作无需考虑线程切换问题）</p>
</li>
<li><p>调用response.body()方法获取Retrofit解析后的对象，也就是List<App>类型数据，最后遍历List</p>
</li>
<li><p>记得声明权限</p>
</li>
<li><p>如果服务器接口是HTTP，则需要进行网络安全配置，并启动配置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrofit 核心库</span></span><br><span class="line">    implementation (<span class="string">&quot;com.squareup.retrofit2:retrofit:2.9.0&quot;</span>)</span><br><span class="line">    <span class="comment">// Gson 转换器</span></span><br><span class="line">    implementation (<span class="string">&quot;com.squareup.retrofit2:converter-gson:2.9.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">binding.getAppDataBtn.setOnClickListener &#123;</span><br><span class="line">          <span class="keyword">val</span> retrofit=Retrofit.Builder()</span><br><span class="line">              .baseUrl(<span class="string">&quot;http://10.0.2.2/&quot;</span>)</span><br><span class="line">              .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">              .build()</span><br><span class="line">          <span class="keyword">val</span> appService=retrofit.create(AppService::<span class="keyword">class</span>.java)</span><br><span class="line">          appService.getAppData().enqueue( <span class="keyword">object</span> :retrofit2.Callback&lt;List&lt;App&gt;&gt; &#123;</span><br><span class="line">              <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">                  call: <span class="type">retrofit2</span>.<span class="type">Call</span>&lt;<span class="type">List</span>&lt;<span class="type">App</span>&gt;&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">                  response: <span class="type">retrofit2</span>.<span class="type">Response</span>&lt;<span class="type">List</span>&lt;<span class="type">App</span>&gt;&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">              )</span></span> &#123;</span><br><span class="line">                  <span class="keyword">val</span> list=response.body()</span><br><span class="line">                  <span class="keyword">if</span>(list!=<span class="literal">null</span>)&#123;</span><br><span class="line">                      <span class="keyword">for</span> (app <span class="keyword">in</span> list)&#123;</span><br><span class="line">                          Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is <span class="subst">$&#123;app.id&#125;</span>&quot;</span>)</span><br><span class="line">                          Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is <span class="subst">$&#123;app.name&#125;</span>&quot;</span>)</span><br><span class="line">                          Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is <span class="subst">$&#123;app.version&#125;</span>&quot;</span>)</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(call: <span class="type">retrofit2</span>.<span class="type">Call</span>&lt;<span class="type">List</span>&lt;<span class="type">App</span>&gt;&gt;, t: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">                  t.printStackTrace()</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="处理复杂的接口地址类型"><a href="#处理复杂的接口地址类型" class="headerlink" title="处理复杂的接口地址类型"></a>处理复杂的接口地址类型</h3><p><code>class Data(val id:String,val content:String)</code></p>
<ul>
<li><p><strong>接口地址是静态</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET http:<span class="comment">//example.com/get_data.json</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@GET(<span class="string">&quot;get_data.json&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getData</span><span class="params">()</span></span>:Call&lt;Data&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>接口地址是动态变化的</strong></p>
<p>page部分代表页数，传入不同页数，返回数据也不同。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET http:<span class="comment">//example.com/&lt;page&gt;/get_data.json</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@GET(<span class="string">&quot;&#123;page&#125;/get_data.json&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getData</span><span class="params">(<span class="meta">@Path(<span class="string">&quot;page&quot;</span>)</span> page:<span class="type">Int</span>)</span></span>:Call&lt;Data&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>接口要求传入一系列参数</strong></p>
<p>这是一个标准的带参数的GET请求格式，接口地址的最后使用问号连接参数，每个参数都是使用等号连接符连接的键值对，多个参数之间用&amp;分隔</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET http:<span class="comment">//example.com/get_data.json?u=&lt;user&gt;&amp;t=&lt;token&gt;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@GET(<span class="string">&quot;get_data.json&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getData</span><span class="params">(<span class="meta">@Query(<span class="string">&quot;u&quot;</span>)</span> user:<span class="type">String</span>,<span class="meta">@Query(<span class="string">&quot;t&quot;</span>)</span> token:<span class="type">String</span>)</span></span>:Call&lt;Data&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多种请求类型</strong></p>
<p>GET请求用于从服务器获取数据，POST请求用于从服务器提交数据，PUT和PATCH请求用于修改服务器上的数据，DELETE请求用于删除服务器上的数据</p>
</li>
<li><p><strong>DELETE请求</strong></p>
<p><strong>使用ResponseBody的原因</strong>：POST,PUT,PATCH和DELETE与GET不同，它们更多用于对数据进行操作，而不是获取数据，所以对服务器响应的数据并不关心，ResponseBody表示能接收任意类型的响应数据，但不对数据进行解析。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE http:<span class="comment">//example.com/data/&lt;id&gt;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@DELETE(<span class="string">&quot;data/&#123;id&#125;&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">deleteData</span><span class="params">(<span class="meta">@Path(<span class="string">&quot;id&quot;</span>)</span> id:<span class="type">String</span>)</span></span>:Call&lt;ResponseBody&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>POST请求</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST http:<span class="comment">//example.com/data/create</span></span><br><span class="line">&#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;The description for this data.&quot;</span>&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@POST(<span class="string">&quot;data/create&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">createData</span><span class="params">(<span class="meta">@Body</span> <span class="keyword">data</span>:<span class="type">Data</span>)</span></span>:Call&lt;ResponseBody&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@Body注解作用</strong>：当发出请求时，会自动将Data对象中的数据转化成JSON格式文本，并放到HTTP请求的body部分，服务器收到请求后只需从body中将这一部分数据解析出来即可，这种写法也可用来给PUT,PATCH和DELETE请求提交数据</p>
</li>
<li><p><strong>在HTTP请求的header中指定参数</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http:<span class="comment">//example.com/get_data.json</span></span><br><span class="line">User-Agent:okhttp</span><br><span class="line">Cache-Control:max-age=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>这些header参数其实就是一个个键值对</p>
<p><strong>静态header声明：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@Headers(<span class="string">&quot;User-Agent:okhttp&quot;</span>,<span class="string">&quot;Cache-Control:max-age=0&quot;</span>)</span></span><br><span class="line">    <span class="meta">@GET(<span class="string">&quot;get_data.json&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getData</span><span class="params">()</span></span>:Call&lt;Data&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>动态header声明：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ExampleService</span>&#123;</span><br><span class="line">    <span class="meta">@GET(<span class="string">&quot;get_data.json&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getData</span><span class="params">(<span class="meta">@Header(<span class="string">&quot;User-Agent&quot;</span>)</span> userAgent:<span class="type">String</span>,<span class="meta">@Header(<span class="string">&quot;Cache-Control&quot;</span>)</span> cacheControl:<span class="type">String</span>)</span></span>:Call&lt;Data&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Retrofit构建器的最佳写法"><a href="#Retrofit构建器的最佳写法" class="headerlink" title="Retrofit构建器的最佳写法"></a>Retrofit构建器的最佳写法</h3><ul>
<li><p>新建一个单例类</p>
</li>
<li><p>将构建Retrofit写法放入</p>
</li>
<li><p>使用泛型实化</p>
</li>
<li><p>调用</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> ServiceCreator&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> BASE_URL=<span class="string">&quot;http://10.0.2.2/&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> retrofit=Retrofit.Builder()</span><br><span class="line">                .baseUrl(BASE_URL)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">create</span><span class="params">(serviceClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T = retrofit.create(serviceClass)</span><br><span class="line">    <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">create</span><span class="params">()</span></span>: T = create(T::<span class="keyword">class</span>.java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appService=ServiceCreator.create&lt;AppService&gt;()</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/06/04/%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/05/29/Kotlin%E6%B3%9B%E5%9E%8B%E7%9A%84%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/">
        <h2 class="post-title">Kotlin泛型的高级特性</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Kotlin/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Kotlin
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/5/29
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="泛型的实化"><a href="#泛型的实化" class="headerlink" title="泛型的实化"></a>泛型的实化</h3><p><strong>条件</strong></p>
<ul>
<li>内联函数</li>
<li>reified关键字修饰</li>
</ul>
<p><strong>举例</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">getGenericType</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<p>启动活动</p>
<ul>
<li>新建一个reified.kt文件</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">startActivity</span><span class="params">(context:<span class="type">Context</span>,block:<span class="type">Intent</span>.()-&gt;<span class="type">Unit</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> intent= Intent(context,T::<span class="keyword">class</span>.java)</span><br><span class="line">    <span class="comment">//高阶函数用于传递数据</span></span><br><span class="line">    intent.block()</span><br><span class="line">    context.startActivity(intent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动活动</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">startActivity&lt;Test&gt;(<span class="keyword">this</span>)&#123;</span><br><span class="line">                putExtra(<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;data&quot;</span>)</span><br><span class="line">                putExtra(<span class="string">&quot;param2&quot;</span>,<span class="number">123</span>)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型的协变"><a href="#泛型的协变" class="headerlink" title="泛型的协变"></a>泛型的协变</h3><p><strong>定义</strong></p>
<p>假如定义一个MyClass<T>的泛型类，其中A是B的子类型，同时MyClass<A>是MyClass<B>的子类型，就称MyClass在T这个泛型上是协变的</p>
<p><strong>条件</strong></p>
<p>一个泛型类在其泛型类型的数据上是只读的情况，简而言之，T只能出现在out位置上，而不能出现在in位置</p>
<p><strong>实例</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在T前使用out关键字声明表示T只能出现在out位置上</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleData</span>&lt;<span class="type">out T</span>&gt;(<span class="keyword">val</span> <span class="keyword">data</span>:T?)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">()</span></span>:T?&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">data</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> student=Student(<span class="string">&quot;Tom&quot;</span>,<span class="number">19</span>)</span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">data</span>=SimpleData&lt;Student&gt;(student)</span><br><span class="line">    handleMyData(<span class="keyword">data</span>)</span><br><span class="line">    <span class="keyword">val</span> studentData=<span class="keyword">data</span>.<span class="keyword">get</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">handleMyData</span><span class="params">(<span class="keyword">data</span>:<span class="type">SimpleData</span>&lt;<span class="type">Person</span>&gt;)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> personData=<span class="keyword">data</span>.<span class="keyword">get</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型的逆变"><a href="#泛型的逆变" class="headerlink" title="泛型的逆变"></a>泛型的逆变</h3><p><strong>定义</strong></p>
<p>假如定义一个MyClass<T>的泛型类，其中A是B的子类型，同时MyClass<B>是MyClass<A>的子类型，就称MyClass在T这个泛型上是逆变的</p>
<p><strong>条件</strong></p>
<p>泛型T前加上in关键字声明，简而言之，T只能出现在in位置上，而不能出现在out位置</p>
<p><strong>实例</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在T前使用out关键字声明表示T只能出现在out位置上</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Transformer</span>&lt;<span class="type">in T</span>&gt;&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">transform</span><span class="params">(t:<span class="type">T</span>)</span></span>:String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> trans=<span class="keyword">object</span>:Transformer&lt;Person&gt;&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">transform</span><span class="params">(t:<span class="type">Person</span>)</span></span>:String&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;<span class="subst">$&#123;t.name&#125;</span> <span class="subst">$&#123;t.age&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    handleTransformer(trans)</span><br><span class="line">&#125;</span><br><span class="line">handleTransformer(trans:Transformer&lt;Student&gt;)&#123;</span><br><span class="line">        <span class="keyword">val</span> student=Student(<span class="string">&quot;Tom&quot;</span>,<span class="number">19</span>)</span><br><span class="line">    	<span class="keyword">val</span> result=trans.transform(student)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/05/29/Kotlin%E6%B3%9B%E5%9E%8B%E7%9A%84%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/05/27/Service-Kotlin/">
        <h2 class="post-title">Service(Kotlin)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Android-Kotlin%E7%89%88/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Android(Kotlin版)
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/5/27
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="多线程编程"><a href="#多线程编程" class="headerlink" title="多线程编程"></a>多线程编程</h1><h3 id="线程的四种形式"><a href="#线程的四种形式" class="headerlink" title="线程的四种形式"></a>线程的四种形式</h3><ul>
<li><pre><code class="language-kotlin">class MyThread:Thread()&#123;
    override fun run()&#123;
        //编写具体逻辑
    &#125;
&#125;
//启动
MyThread.start()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```kotlin</span><br><span class="line">  class MyThread:Runnable&#123;</span><br><span class="line">      override fun run()&#123;</span><br><span class="line">          //编写具体逻辑</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  //启动</span><br><span class="line">  val myThread=MyThread()</span><br><span class="line">  Thread(myThread).start()</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><pre><code class="language-kotlin">Thread&#123;
    //编写具体逻辑
&#125;.start()
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```kotlin</span><br><span class="line">  thread&#123;</span><br><span class="line">      //编写具体逻辑</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

**最后一种是Kotlin内置的顶层函数，更加简单方便**
</code></pre>
</li>
</ul>
<h3 id="在子线程中更新UI"><a href="#在子线程中更新UI" class="headerlink" title="在子线程中更新UI"></a>在子线程中更新UI</h3><ol>
<li>定义一个整型变量表示更新UI的动作</li>
<li>新增一个Handler对象，重写父类handleMessage()方法，在这里对UI进行具体操作</li>
<li>开启子线程</li>
<li>创建Message对象</li>
<li>指定what字段值</li>
<li>调用sendMessage()方法发送Message</li>
</ol>
<h3 id="解析异步消息处理机制"><a href="#解析异步消息处理机制" class="headerlink" title="解析异步消息处理机制"></a>解析异步消息处理机制</h3><p><img src="/../img/img48.jpg"></p>
<p><img src="/../img/img49.jpg"></p>
<h3 id="使用AsyncTask"><a href="#使用AsyncTask" class="headerlink" title="使用AsyncTask"></a>使用AsyncTask</h3><p>1.创建一个子类去继承它，需要传入三个参数如下</p>
<p>Params：在后台任务中使用</p>
<p>Progress：可以作为进度单位</p>
<p>Result：返回值类型</p>
<p>2.重写父类方法如下：</p>
<p>onPreExecute():界面上的初始化操作</p>
<p>doInBackground(Params…):所有代码都在子线程中运行，在这里处理耗时任务</p>
<p>onProgressUpdate(Progress…):对UI进行操作</p>
<p>onPostExecute(Result):后台任务执行完毕并通过return语句返回时，这个方法被调用</p>
<p>3.启动任务</p>
<p><code>DownloadTask().execute()</code></p>
<hr>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><ol>
<li>定义service，直接用AndroidStudio系统新建</li>
<li>利用Intent启动和停止Service</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyService</span> : <span class="type">Service</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;onCreate: &quot;</span>)    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;onStartCommand: &quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;onDestroy: &quot;</span>)</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">binding.start.setOnClickListener &#123;</span><br><span class="line">         <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,MyService::<span class="keyword">class</span>.java)</span><br><span class="line">         <span class="comment">//启动服务</span></span><br><span class="line">         startService(intent)</span><br><span class="line">     &#125;</span><br><span class="line">     binding.stop.setOnClickListener &#123;</span><br><span class="line">         <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,MyService::<span class="keyword">class</span>.java)</span><br><span class="line">         <span class="comment">//停止服务</span></span><br><span class="line">         stopService(intent)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Activity和Service进行通信"><a href="#Activity和Service进行通信" class="headerlink" title="Activity和Service进行通信"></a>Activity和Service进行通信</h3><p>拿下载功能举例</p>
<p>Service中提供一个下载功能，Activity中可以决定何时开始下载以及随时查看下载进度</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> mBinder=DownloadBinder()</span><br><span class="line">   <span class="keyword">class</span> <span class="title class_">DownloadBinder</span>:<span class="type">Binder</span>()&#123;</span><br><span class="line">       <span class="function"><span class="keyword">fun</span> <span class="title">startDownload</span><span class="params">()</span></span>&#123;</span><br><span class="line">           Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;startDownload: &quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="function"><span class="keyword">fun</span> <span class="title">getProgress</span><span class="params">()</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">           Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;getProgress: &quot;</span>)</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">       <span class="keyword">return</span> mBinder</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>创建ServiceConnection的匿名类实现</p>
<ol>
<li><p>重写父类的两个方法</p>
</li>
<li><p>利用intent和bindService进行绑定</p>
</li>
<li><p>利用unbindService()方法解绑</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> downloadBinder:MyService.DownloadBinder</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> connection=<span class="keyword">object</span> :ServiceConnection&#123;</span><br><span class="line">        <span class="comment">//成功绑定时使用</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceConnected</span><span class="params">(name: <span class="type">ComponentName</span>?, service: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">            downloadBinder=service <span class="keyword">as</span> MyService.DownloadBinder</span><br><span class="line">            downloadBinder.startDownload()</span><br><span class="line">            downloadBinder.getProgress()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Service创建进程崩溃或被杀掉时调用</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceDisconnected</span><span class="params">(name: <span class="type">ComponentName</span>?)</span></span> &#123;</span><br><span class="line">            TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        binding.bind.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,MyService::<span class="keyword">class</span>.java)</span><br><span class="line">            <span class="comment">//绑定Service</span></span><br><span class="line">            bindService(intent,connection, Context.BIND_AUTO_CREATE)</span><br><span class="line">        &#125;</span><br><span class="line">        binding.unbind.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">//解绑Service</span></span><br><span class="line">            unbindService(connection)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Service更多技巧"><a href="#Service更多技巧" class="headerlink" title="Service更多技巧"></a>Service更多技巧</h1><h3 id="使用前台Service"><a href="#使用前台Service" class="headerlink" title="使用前台Service"></a>使用前台Service</h3><ol>
<li><p>调用startForeground方法会让一个service变成前台服务</p>
</li>
<li><p>声明权限</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MyService&quot;</span>, <span class="string">&quot;onCreate: &quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> manager=getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">        <span class="keyword">if</span>(Build.VERSION.SDK_INT&gt;=Build.VERSION_CODES.O)&#123;</span><br><span class="line">            <span class="keyword">val</span> channel=NotificationChannel(<span class="string">&quot;my_service&quot;</span>,<span class="string">&quot;前台Service通知&quot;</span>,NotificationManager.IMPORTANCE_DEFAULT)</span><br><span class="line">            manager.createNotificationChannel(channel)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,MainActivity::<span class="keyword">class</span>.java)</span><br><span class="line">        <span class="keyword">val</span> pi=PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>,intent, PendingIntent.FLAG_IMMUTABLE)</span><br><span class="line">        <span class="keyword">val</span> notification=NotificationCompat.Builder(<span class="keyword">this</span>,<span class="string">&quot;my_service&quot;</span>)</span><br><span class="line">            .setContentTitle(<span class="string">&quot;This is title&quot;</span>)</span><br><span class="line">            .setContentText(<span class="string">&quot;This is Context&quot;</span>)</span><br><span class="line">            .setSmallIcon(R.drawable.ic_launcher_foreground)</span><br><span class="line">            .setLargeIcon(BitmapFactory.decodeResource(resources,R.drawable.ic_launcher_background))</span><br><span class="line">            .setContentIntent(pi)</span><br><span class="line">            .build()</span><br><span class="line">        startForeground(<span class="number">1</span>,notification)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h3><ol>
<li>新建一个类继承IntentService</li>
<li>实现onHandleIntent()抽象方法，这个方法用于处理耗时的逻辑(在子线程中运行li)</li>
<li>利用Intent启动IntentService</li>
<li>注册IntentService</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyIntentService</span> : <span class="type">IntentService</span>(<span class="string">&quot;MyIntentService&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHandleIntent</span><span class="params">(intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">//打印当前线程id</span></span><br><span class="line">        Log.d(<span class="string">&quot;MyIntentService&quot;</span>, <span class="string">&quot;Thread id is <span class="subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        Log.d(<span class="string">&quot;MyIntentService&quot;</span>, <span class="string">&quot;onDestroy: &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">binding.startintent.setOnClickListener &#123;</span><br><span class="line">           <span class="comment">//打印主线程id</span></span><br><span class="line">           Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;Thread id is <span class="subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)</span><br><span class="line">           <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,MyIntentService::<span class="keyword">class</span>.java)</span><br><span class="line">           startService(intent)</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;service</span><br><span class="line">            android:name=<span class="string">&quot;.MyIntentService&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure>

<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/05/27/Service-Kotlin/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/05/26/Kotlin%E7%9A%84infix%E5%87%BD%E6%95%B0/">
        <h2 class="post-title">Kotlin的infix函数</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Kotlin/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Kotlin
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/5/26
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p><code>infix</code> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%85%B3%E9%94%AE%E5%AD%97&spm=1001.2101.3001.7020">关键字</a>可以让 <strong>单参数的函数</strong> 以 <strong>更自然的语法</strong> 书写，使代码更易读。<br>你可以把它理解为 <strong>一种特殊的调用方式</strong>，不需要 <code>.</code> 和 <code>()</code>，让代码像 <strong>自然语言</strong> 一样流畅。例如mapOf中的键值对(A to B实际等价于A.to(B))省略了  <code>.</code>  和  <code>（）</code>。</p>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><p>要使用 <code>infix</code>，需要满足 <strong>三个条件</strong>：</p>
<ol>
<li><strong>必须是成员函数或扩展函数</strong>（它必须属于某个类或某种类型）。</li>
<li><strong>必须只有且只能有一个参数</strong>（如果有多个参数，就不能用 <code>infix</code>）。</li>
<li>⭐⭐⭐⭐⭐⭐<strong>调用时可以省略 <code>.</code> 和 <code>()</code></strong>（但仍然可以用 <code>.</code> 调用）。</li>
</ol>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Collection<span class="type">&lt;T&gt;</span>.<span class="title">has</span><span class="params">(element:<span class="type">T</span>)</span></span>=contains(element)</span><br><span class="line"><span class="keyword">val</span> list =listOf(<span class="string">&quot;Apple&quot;</span>,<span class="string">&quot;Banana&quot;</span>,<span class="string">&quot;Orange&quot;</span>,<span class="string">&quot;Pear&quot;</span>,<span class="string">&quot;Grape&quot;</span>)</span><br><span class="line"><span class="keyword">if</span>(list has <span class="string">&quot;Banana&quot;</span>)&#123;</span><br><span class="line">    <span class="comment">//处理具体逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/05/26/Kotlin%E7%9A%84infix%E5%87%BD%E6%95%B0/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2025/05/24/%E6%89%8B%E6%9C%BA%E5%A4%9A%E5%AA%92%E4%BD%93-Kotlin/">
        <h2 class="post-title">手机多媒体(Kotlin)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Android-Kotlin%E7%89%88/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Android(Kotlin版)
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/5/24
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="通知-进阶"><a href="#通知-进阶" class="headerlink" title="通知(进阶)"></a>通知(进阶)</h1><ol>
<li><p>创建通知渠道</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> manager=getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">       <span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O)&#123;</span><br><span class="line">           <span class="comment">/*参数介绍：</span></span><br><span class="line"><span class="comment">           1.渠道id</span></span><br><span class="line"><span class="comment">           2.渠道名称</span></span><br><span class="line"><span class="comment">           3.重要等级</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">           <span class="keyword">val</span> channel=NotificationChannel(<span class="string">&quot;normal&quot;</span>,<span class="string">&quot;Normal&quot;</span>,NotificationManager.IMPORTANCE_DEFAULT)</span><br><span class="line">           <span class="keyword">val</span> channel2=NotificationChannel(<span class="string">&quot;important&quot;</span>,<span class="string">&quot;Important&quot;</span>,NotificationManager.IMPORTANCE_HIGH)</span><br><span class="line">           <span class="comment">//创建通道</span></span><br><span class="line">           manager.createNotificationChannel(channel2)</span><br><span class="line">           manager.createNotificationChannel(channel)</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>创建Notification对象</p>
</li>
<li><p>通过连缀设置丰富的Notification对象</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> notification=NotificationCompat.Builder(<span class="keyword">this</span>,<span class="string">&quot;important&quot;</span>)</span><br><span class="line">                .setContentTitle(<span class="string">&quot;Title&quot;</span>)</span><br><span class="line">                .setContentText(<span class="string">&quot;Text&quot;</span>)</span><br><span class="line">                .setSmallIcon(R.drawable.small_icon)</span><br><span class="line">                .setLargeIcon(BitmapFactory.decodeResource(resources,R.drawable.large_icon))</span><br><span class="line">                .setContentIntent(pi)<span class="comment">//点击界面跳转</span></span><br><span class="line">                .setAutoCancel(<span class="literal">true</span>)<span class="comment">//点击后图标自动消失</span></span><br><span class="line"><span class="comment">//富文本</span></span><br><span class="line">                .setStyle(NotificationCompat.BigTextStyle().bigText(<span class="string">&quot;Learn how to build notifications, send and sync data, and use voice actions. Get the official Android IDE and developer tools to build apps for Android.&quot;</span>))    </span><br><span class="line"><span class="comment">//显示图片</span></span><br><span class="line">.setStyle(NotificationCompat.BigPictureStyle().bigPicture(BitmapFactory.decodeResource(resources,R.drawable.big_image)))</span><br><span class="line">                .build()</span><br></pre></td></tr></table></figure>


</li>
<li><p>显示通知</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager.notify(<span class="number">1</span>,notification)</span><br></pre></td></tr></table></figure>


</li>
<li><p>设置点击事件</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">val</span> intent=Intent(<span class="keyword">this</span>,NotificationActivity::<span class="keyword">class</span>.java)</span><br><span class="line"> <span class="keyword">val</span> pi=PendingIntent.getActivity(<span class="keyword">this</span>,<span class="number">0</span>,intent,<span class="number">0</span>)</span><br><span class="line"><span class="comment">//在Notification对象中加入setContentIntent连缀</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>图标消失的两种方法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.在Notification对象后加setAutoCancel连缀</span></span><br><span class="line"><span class="comment">//2.在界面跳转后的那个界面输入以下代码：</span></span><br><span class="line"><span class="comment">//val manager=getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager</span></span><br><span class="line"><span class="comment">//manager.cancel(1)“1”是指notify方法中传入的那个id</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="调用摄像头和相册"><a href="#调用摄像头和相册" class="headerlink" title="调用摄像头和相册"></a>调用摄像头和相册</h1><h3 id="用摄像头拍照"><a href="#用摄像头拍照" class="headerlink" title="用摄像头拍照"></a>用摄像头拍照</h3><ol>
<li><p>首先创建一个File对象，用于存储拍下的照片</p>
</li>
<li><p>接下来通过判断版本进行操作，如果版本低于Android7.0就调用Uri的**fromFile()**方法转换为Uri对象（这个标识着图片的本地真实路径），如果版本高于7.0就调用FileProvider的getUriForFile()方法，将File转换成一个封装过的Uri对象</p>
</li>
<li><p>构建Intent对象，启动相机程序(利用startActivityForResult进行启动)</p>
</li>
<li><p>重写onActivityResult方法</p>
</li>
<li><p>判断图片方向，如果需要旋转并进行旋转</p>
</li>
<li><p>由于用到ContentProvider，故需要注册</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;provider</span><br><span class="line">           android:authorities=<span class="string">&quot;com.example.cameraalbumtest.fileprovider&quot;</span></span><br><span class="line">           android:name=<span class="string">&quot;androidx.core.content.FileProvider&quot;</span></span><br><span class="line">           android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">           android:grantUriPermissions=<span class="string">&quot;true&quot;</span></span><br><span class="line">           &gt;</span><br><span class="line">           &lt;meta-<span class="keyword">data</span></span><br><span class="line">               android:name=<span class="string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span><br><span class="line">               android:resource=<span class="string">&quot;@xml/file_paths&quot;</span>/&gt;</span><br><span class="line">       &lt;/provider&gt;</span><br></pre></td></tr></table></figure>


</li>
<li><p>指定共享路径</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;paths xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">external</span>-path</span><br><span class="line">        name=<span class="string">&quot;my_images&quot;</span></span><br><span class="line">        path=<span class="string">&quot;/&quot;</span>/&gt;</span><br><span class="line">&lt;/paths&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="从相册中选择"><a href="#从相册中选择" class="headerlink" title="从相册中选择"></a>从相册中选择</h3><ol>
<li>构建一个Intent对象表示打开文件选择器，并设置条件过滤</li>
<li>结果返回到onActivityResult中，调用getBitmapFromUri方法将Uri转换成Bitmap对象</li>
<li>将图片显示出来</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="comment">// ViewBinding对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding:ActivityMainBinding</span><br><span class="line">    <span class="comment">// 从相册选择照片的请求码</span></span><br><span class="line">    <span class="keyword">val</span> fromAlbum=<span class="number">2</span></span><br><span class="line">    <span class="comment">// 拍照请求码</span></span><br><span class="line">    <span class="keyword">val</span> takePhoto=<span class="number">1</span></span><br><span class="line">    <span class="comment">// 用于存储拍照后图片的Uri</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> imageUri:Uri</span><br><span class="line">    <span class="comment">// 用于存储拍照后图片的文件</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> outputImage:File</span><br><span class="line">    <span class="meta">@SuppressLint(<span class="string">&quot;ObsoleteSdkInt&quot;</span>)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="comment">// 启用沉浸式状态栏</span></span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        <span class="comment">// 初始化ViewBinding</span></span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        <span class="comment">// 适配系统窗口，防止内容被遮挡</span></span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 拍照按钮点击事件</span></span><br><span class="line">        binding.takephoto.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 创建File对象，用于存储照片</span></span><br><span class="line">            outputImage=File(externalCacheDir,<span class="string">&quot;output_image.jpg&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> (outputImage.exists())&#123;</span><br><span class="line">                <span class="comment">// 如果文件已存在则删除</span></span><br><span class="line">                outputImage.delete()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 创建新文件</span></span><br><span class="line">            outputImage.createNewFile()</span><br><span class="line">            <span class="comment">// 判断Android版本，获取图片Uri</span></span><br><span class="line">            imageUri=<span class="keyword">if</span>(Build.VERSION.SDK_INT&gt;=Build.VERSION_CODES.N)&#123;</span><br><span class="line">                <span class="comment">// 7.0及以上使用FileProvider</span></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                *第一个参数是Context</span></span><br><span class="line"><span class="comment">                第二个参数是任意的唯一字符串</span></span><br><span class="line"><span class="comment">                第三个是刚创建的File对象</span></span><br><span class="line"><span class="comment">                **/</span></span><br><span class="line">                FileProvider.getUriForFile(<span class="keyword">this</span>,<span class="string">&quot;com.example.cameraalbumtest.fileprovider&quot;</span>,outputImage)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// 7.0以下直接使用Uri.fromFile</span></span><br><span class="line">                Uri.fromFile(outputImage)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 启动相机程序</span></span><br><span class="line">            <span class="keyword">val</span> intent=Intent(<span class="string">&quot;android.media.action.IMAGE_CAPTURE&quot;</span>)</span><br><span class="line">            <span class="comment">// 指定图片输出地址</span></span><br><span class="line">            intent.putExtra(MediaStore.EXTRA_OUTPUT,imageUri)</span><br><span class="line">            <span class="comment">// 启动相机Activity</span></span><br><span class="line">            startActivityForResult(intent,takePhoto)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从相册选择按钮点击事件</span></span><br><span class="line">        binding.fromAlbumBtn.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 打开文件选择器</span></span><br><span class="line">            <span class="keyword">val</span> intent=Intent(Intent.ACTION_OPEN_DOCUMENT)</span><br><span class="line">            <span class="comment">// 添加可打开的类别，确保文件可以被打开</span></span><br><span class="line">            intent.addCategory(Intent.CATEGORY_OPENABLE)</span><br><span class="line">            <span class="comment">// 指定只显示图片类型的文件</span></span><br><span class="line">            intent.type=<span class="string">&quot;image/*&quot;</span></span><br><span class="line">            <span class="comment">// 启动文件选择器Activity</span></span><br><span class="line">            startActivityForResult(intent,fromAlbum)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 拍照Activity返回结果回调</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        requestCode: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        resultCode: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">data</span>: <span class="type">Intent</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        caller: <span class="type">ComponentCaller</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>, caller)</span><br><span class="line">        <span class="keyword">when</span>(requestCode)&#123;</span><br><span class="line">            takePhoto-&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span>(resultCode== Activity.RESULT_OK)&#123;</span><br><span class="line">                    <span class="comment">// 将拍摄照片显示出来</span></span><br><span class="line">                    <span class="keyword">val</span> bitmap=BitmapFactory.decodeStream(contentResolver.openInputStream(imageUri))</span><br><span class="line">                    <span class="comment">// 处理图片旋转问题后显示</span></span><br><span class="line">                    binding.imageView.setImageBitmap(rotateIfRequired(bitmap))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 处理从相册选择照片的返回结果</span></span><br><span class="line">            fromAlbum-&gt;&#123;</span><br><span class="line">                <span class="comment">// 检查结果码是否成功且数据不为空</span></span><br><span class="line">                <span class="keyword">if</span>(resultCode==Activity.RESULT_OK&amp;&amp;<span class="keyword">data</span>!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="comment">// 获取选定图片的Uri</span></span><br><span class="line">                    <span class="keyword">data</span>.<span class="keyword">data</span>?.let &#123; uri-&gt;</span><br><span class="line">                        <span class="comment">// 根据Uri获取Bitmap对象并显示</span></span><br><span class="line">                        <span class="keyword">val</span> bitmap=getBitmapFromUri(uri)</span><br><span class="line">                        binding.imageView.setImageBitmap(bitmap)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据Uri获取图片的Bitmap对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getBitmapFromUri</span><span class="params">(uri: <span class="type">Any</span>)</span></span>=contentResolver.openFileDescriptor(uri <span class="keyword">as</span> Uri,<span class="string">&quot;r&quot;</span>)?.use &#123;</span><br><span class="line">        <span class="comment">// 使用文件描述符解码Bitmap</span></span><br><span class="line">        BitmapFactory.decodeFileDescriptor(it.fileDescriptor)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 判断图片是否需要旋转，并进行旋转</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">rotateIfRequired</span><span class="params">(bitmap: <span class="type">Bitmap</span>?)</span></span>: Bitmap? &#123;</span><br><span class="line">         <span class="keyword">val</span> exif=ExifInterface(outputImage.path)</span><br><span class="line">        <span class="comment">// 读取图片的旋转角度</span></span><br><span class="line">        <span class="keyword">val</span> orientation=exif.getAttributeInt(ExifInterface.TAG_ORIENTATION,ExifInterface.ORIENTATION_NORMAL)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">when</span>(orientation)&#123;</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_90-&gt;rotateBitmap(bitmap,<span class="number">90</span>)</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_180-&gt;rotateBitmap(bitmap,<span class="number">180</span>)</span><br><span class="line">            ExifInterface.ORIENTATION_ROTATE_270-&gt;rotateBitmap(bitmap,<span class="number">270</span>)</span><br><span class="line">            <span class="keyword">else</span>-&gt;bitmap</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 旋转Bitmap图片</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">rotateBitmap</span><span class="params">(bitmap: <span class="type">Bitmap</span>?, i: <span class="type">Int</span>)</span></span>: Bitmap? &#123;</span><br><span class="line">            <span class="keyword">val</span> matrix=Matrix()</span><br><span class="line">        <span class="comment">// 设置旋转角度</span></span><br><span class="line">        matrix.postRotate(degree.toFloat())</span><br><span class="line">        <span class="comment">// 创建旋转后的Bitmap</span></span><br><span class="line">        <span class="keyword">val</span> rotatedBitmap=Bitmap.createBitmap(bitmap!!,<span class="number">0</span>,<span class="number">0</span>,bitmap.width,bitmap.height,matrix,<span class="literal">true</span>)</span><br><span class="line">        <span class="comment">// 将不再需要的Bitmap对象回收，释放内存</span></span><br><span class="line">        bitmap.recycle()</span><br><span class="line">        <span class="keyword">return</span> rotatedBitmap</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="播放多媒体"><a href="#播放多媒体" class="headerlink" title="播放多媒体"></a>播放多媒体</h1><h3 id="播放音频"><a href="#播放音频" class="headerlink" title="播放音频"></a>播放音频</h3><ul>
<li><p><strong>MdeiaPlayer类常用方法</strong></p>
<p><img src="/../img/img58.jpg"></p>
</li>
<li><p><strong>过程</strong></p>
<ol>
<li><p>首先在main文件夹下创建一个assets文件夹，在里面放入要播放的音频</p>
</li>
<li><p>创建一个MediaPlayer对象</p>
</li>
<li><p>初始化MdeiaPlayer对象</p>
</li>
<li><p>利用MediaPlayer中的方法对音频文件状态进行判断并执行相应的操作</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding:ActivityMainBinding</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mediaPlayer=MediaPlayer()</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        initMediaPlayer()</span><br><span class="line">        binding.play.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(!mediaPlayer.isPlaying)&#123;</span><br><span class="line">                mediaPlayer.start()<span class="comment">//开始播放</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        binding.pause.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(mediaPlayer.isPlaying)&#123;</span><br><span class="line">                mediaPlayer.pause()<span class="comment">//暂停播放</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        binding.stop.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(mediaPlayer.isPlaying)&#123;</span><br><span class="line">                <span class="comment">//停止播放</span></span><br><span class="line">                mediaPlayer.reset()</span><br><span class="line">                initMediaPlayer()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initMediaPlayer</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//得到AssetManager实例，读取assets目录下任何资源</span></span><br><span class="line">        <span class="keyword">val</span> assetManager=assets</span><br><span class="line">        <span class="comment">//将音频文件句柄打开</span></span><br><span class="line">        <span class="keyword">val</span> fd=assetManager.openFd(<span class="string">&quot;music.mp3&quot;</span>)</span><br><span class="line">        <span class="comment">//为音频做好播放前准备</span></span><br><span class="line">        mediaPlayer.setDataSource(fd.fileDescriptor,fd.startOffset,fd.length)</span><br><span class="line">        mediaPlayer.prepare()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mediaPlayer.stop()</span><br><span class="line">        mediaPlayer.release()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="播放视频"><a href="#播放视频" class="headerlink" title="播放视频"></a>播放视频</h3><ul>
<li><p><strong>VideoView常用方法</strong></p>
<p><img src="/../img/img57.jpg"></p>
</li>
<li><p><strong>过程</strong></p>
<ol>
<li><p>利用VideoView控件显示视频</p>
</li>
<li><p>在res文件夹下新建raw文件夹放置视频文件</p>
</li>
<li><p>利用VideoView中的方法对音频文件状态进行判断并执行相应的操作</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    xmlns:app=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="line">    xmlns:tools=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="line">    android:id=<span class="string">&quot;@+id/main&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    tools:context=<span class="string">&quot;.MainActivity&quot;</span></span><br><span class="line">    android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span>&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/play&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;Play&quot;</span>/&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/pause&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;Pause&quot;</span>/&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/replay&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;Replay&quot;</span>/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">    &lt;VideoView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/videoView&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding:ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enableEdgeToEdge()</span><br><span class="line">        binding=ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main)) &#123; v, insets -&gt;</span><br><span class="line">            <span class="keyword">val</span> systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars())</span><br><span class="line">            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom)</span><br><span class="line">            insets</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> uri=Uri.parse(<span class="string">&quot;android.resource://<span class="variable">$packageName</span>/<span class="subst">$&#123;R.raw.video&#125;</span>&quot;</span>)</span><br><span class="line">        binding.videoView.setVideoURI(uri)</span><br><span class="line">        binding.play.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(!binding.videoView.isPlaying)&#123;</span><br><span class="line">                binding.videoView.start()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        binding.pause.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(binding.videoView.isPlaying)&#123;</span><br><span class="line">                binding.videoView.pause()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        binding.replay.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span>(binding.videoView.isPlaying)&#123;</span><br><span class="line">                binding.videoView.resume()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        binding.videoView.<span class="keyword">suspend</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<hr>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/05/24/%E6%89%8B%E6%9C%BA%E5%A4%9A%E5%AA%92%E4%BD%93-Kotlin/" class="go-post">阅读全文</a>
</div>


        <div class="page-current">
    
    <a class="page-num" href="/page/2/">
        <i class="fa-solid fa-caret-left fa-fw"></i>
    </a>
    <a class="page-num" href="/">1</a>
    <span class="page-omit">...</span>
    
    <span class="current">3</span>
    
    <a class="page-num" href="/page/4">
        4
    </a>
    
    
    <a class="page-num" href="/page/5">
        5
    </a>
    
    
    <span class="page-omit">...</span>
    <a class="page-num" href="/page/6">6</a>
    
    
    <a class="page-num" href="/page/4/">
        <i class="fa-solid fa-caret-right fa-fw"></i>
    </a>
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/avatar.jpg" alt="avatar" />
        </div>
        <div class="name">John Doe</div>
        <div class="description">
            <p>Description<br>…</p>

        </div>
        
        
        <div class="friend-links">
            
            <div class="friend-link">
                <a target="_blank" rel="noopener" href="https://argvchs.github.io">Argvchs</a>
            </div>
            
        </div>
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 Hexo
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;John Doe
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
</body>
</html>
